<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-1.0"
      xmlns:ctrl="http://n2oapp.net/framework/config/schema/n2o-control-1.0"
      xmlns:wgt="http://n2oapp.net/framework/config/schema/n2o-widget-2.0"
      xmlns:fs="http://n2oapp.net/framework/config/schema/fieldset-2.0">
    <!--<id>queue</id>-->
    <name>Журнал диспетчера направления</name>
    <object-id>queue</object-id>
    <layout>ext/css/queueLayout</layout>
    <regions>
        <region place="left" type="none">
            <container id="top" place="top" depends-on="queue">
                <wgt:form master-field-id="id" detail-field-id="id" src="ext/css/amb03-control-container-queue"
                          customize="css" css-class="card-queue">
                    <wgt:name>Информация о вызове</wgt:name>
                    <wgt:query-id>callqueue</wgt:query-id>
                    <fs:field-set>
                        <fs:row>
                            <!--<ctrl:input-text id="phone" readonly="true" css-class="n2o-control-4 n2o-label-3"/>-->
                            <ctrl:output-text id="employee.name" readonly="true" css-class="ambqueue-remp grey-label"/>
                            <ctrl:output-text id="from_time" label="Принят" readonly="true"
                                              css-class="ambqueue-receipt_time grey-label"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:output-text id="caller_reason.name" readonly="true"
                                              dependency-condition="call_kind.id != 3 &amp;&amp; call_kind.id != 4"
                                              css-class="ambqueue-reason grey-label"/>
                            <ctrl:output-text id="diagnosis.name" readonly="true"
                                              dependency-condition="call_kind.id == 3 || call_kind.id == 4"
                                              css-class="ambqueue-diagnosis grey-label"/>
                            <ctrl:output-text id="state_history.datetime" label="Время" readonly="true"
                                              css-class="ambqueue-history-dt grey-label"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:output-text id="descr" readonly="true" css-class="ambqueue-descr grey-label"/>
                            <ctrl:output-text id="call_state.name" readonly="true"
                                              css-class="ambqueue-state grey-label"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:output-text id="notes" readonly="true" css-class="ambqueue-notes grey-label"/>
                            <ctrl:output-text id="time" label="Длительность" readonly="false"
                                              dependency-condition="call_state.name != 'окончание вызова'"
                                              css-class="ambqueue-time grey-label"/>
                            <ctrl:output-text id="calltime" label="Время обсл-я" readonly="false"
                                              dependency-condition="call_state.name == 'окончание вызова'"
                                              css-class="ambqueue-calltime grey-label"/>
                        </fs:row>
                        <!-- новое  -->
                        <fs:row>
                            <ctrl:output-text id="patFIO" label="Пациент" css-class="ambqueue-patient grey-label"/>
                            <!--<ctrl:output-text id="notes" label="" css-class="ambqueue-age grey-label"/>-->
                            <ctrl:output-text id="processing_profile.name" label="Профиль"
                                              css-class="ambqueue-phone grey-label"/>
                        </fs:row>
                    </fs:field-set>
                </wgt:form>
            </container>
            <container id="queue" place="bottom" depends-on="parent" refresh-dependent-container="true">
                <wgt:table master-field-id="id" detail-field-id="par_id" customize="js" src="ext/js/autoRefreshTable">
                    <wgt:query-id>callqueue</wgt:query-id>
                    <wgt:name>Очередь вызовов</wgt:name>
                    <wgt:size>20</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="time" width="40px">
                        </wgt:column>
                        <wgt:column column-field-id="number" width="25px"/>
                        <wgt:column column-field-id="call_kind.code" width="25px">
                            <wgt:color color-field-id="priority.color"/>
                        </wgt:column>
                        <wgt:column column-field-id="notes" width="30px"/>
                        <wgt:column column-field-id="address" width="130px"/>
                        <wgt:column column-field-id="gender.names" width="25px"/>
                        <wgt:column column-field-id="caller_reason.name" width="150px"/>
                        <wgt:column column-field-id="priorityNum" width="110px"/>
                    </wgt:columns>
                    <wgt:rows>
                        <wgt:color>
                            <wgt:switch value-field-id="time_color">
                                <wgt:case value="true">muted</wgt:case>
                            </wgt:switch>
                        </wgt:color>
                    </wgt:rows>
                    <wgt:sortings>
                        <wgt:sorting sorting-field-id="priorNum" direction="DESC"/>
                        <wgt:sorting sorting-field-id="from_time" direction="DESC"/>
                    </wgt:sortings>
                    <wgt:filters position="top" opened="false">
                        <ctrl:input-text id="number"/>
                    </wgt:filters>
                    <wgt:action-menu>
                        <wgt:menu-item id="create" label="Создать" context="false" key="Insert" type="icon">
                            <wgt:show-modal page-id="call_ins" width="925px" refresh-on-close="true"
                                            result-container-id="call"
                                            page-name="Создать карту вызова диспетчера" action-id="create"
                                            focus-after-submit="false">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="change.id" ref="actual_change.id"/>
                                    <wgt:pre-filter field-id="change.data" ref="actual_change.data"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="update" label="Изменить (Enter)" context="true" key="Enter" default="false"
                                       type="icon">
                            <wgt:show-modal page-id="call_upd" width="925px" refresh-on-close="true"
                                            result-container-id="call"
                                            page-name="Изменить карту вызова диспетчера №{queue.number}"
                                            action-id="update"/>
                            <wgt:properties>
                                <wgt:property key="security-replace" value="read"/>
                            </wgt:properties>
                        </wgt:menu-item>
                        <wgt:menu-item id="read" label="Просмотр" context="true" default="false" key="Alt+Enter"
                                       visible="false" icon="glyphicons glyphicons-display" type="icon">
                            <wgt:show-modal page-id="call_upd" width="925px"/>
                        </wgt:menu-item>

                        <wgt:menu-item id="notes" label="Отметки">
                            <wgt:sub-menu>
                                <wgt:menu-item id="citi1" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="in_cityservice" container-id="top" master-field-id="id"
                                                    detail-field-id="call_id" width="715px" refresh-on-close="true"
                                                    page-name="Передача вызова №{queue.number} в службы города">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="call_note.type" value="true"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="citi2" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal action-id="create" page-id="in_cityservice_ins"
                                                    container-id="single" master-field-id="id" detail-field-id="call_id"
                                                    width="715px" refresh-on-close="true"
                                                    page-name="Передача вызова №{queue.number} в службы города"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="selfrefused" label="Самоотказ(Alt+2)" key="Alt+2" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="selfrefused" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" width="545px" refresh-on-close="true"
                                                    page-name="Самоотказ на вызове №{queue.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="doctor_refusal" label="Отказ врача(Alt+3)" key="Alt+3" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="doctor_refusal" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Отказ врача на вызове №{queue.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="alcoholization" label="Алкогольное опьянение (Alt+3)" key="Alt+3"
                                               context="true" default="false">
                                    <wgt:invoke-action action-id="alcohol" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_alcoholization" label="Снятие Алкогольного опьянения (Alt+3)"
                                               key="Alt+3" context="true" default="false">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку алкогольного опьянения с вызова №{queue.number} ({queue.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="alco_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="alco_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="hospitalization" label="Госпитализация(Alt+4)" key="Alt+4"
                                               context="true" default="false">
                                    <wgt:show-modal page-id="hospitalization" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="600px"
                                                    page-name="Госпитализация больного на вызове №{queue.number}"/>
                                </wgt:menu-item>
                                <wgt:menu-item id="double" label="Повторный/задвоенный(Alt+5)" default="false"
                                               key="Alt+5" context="true">
                                    <wgt:show-modal page-id="call_double" container-id="top" master-field-id="id"
                                                    detail-field-id="id" refresh-on-close="true" width="700px"
                                                    page-name="Повторность/Задвоенность вызова №{queue.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_road_accident" label="ДТП (Alt+6)" default="false" key="Alt+6"
                                               context="true">

                                    <wgt:invoke-action action-id="road_acc" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_road_accident" label="Снятие ДТП (Alt+6)" default="false"
                                               key="Alt+6" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку ДТП с вызова №{queue.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="road_acc_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="road_acc_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_fire" label="Пожар (Alt+7)" default="false" key="Alt+7"
                                               context="true">
                                    <wgt:invoke-action action-id="fire" confirmation="false"/>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_fire" label="Снятие Пожара (Alt+7)" default="false" key="Alt+7"
                                               context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку пожара с вызова №{queue.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="fire_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="fire_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_crime" label="Криминал (Alt+8)" default="false" key="Alt+8"
                                               context="true">
                                    <wgt:invoke-action action-id="crime" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>

                                </wgt:menu-item>

                                <wgt:menu-item id="del_crime" label="Снятие Криминала (Alt+8)" default="false"
                                               key="Alt+8" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку криминала с вызова №{queue.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="crime_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="crime_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_dang" label="Особо опасный объект (Alt+9)" default="false"
                                               key="Alt+9" context="true">

                                    <wgt:invoke-action action-id="danger" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_dang" label="Снятие Особо опасного объекта (Alt+9)"
                                               default="false" key="Alt+9" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку особо опасного объекта с вызова №{queue.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="danger_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="danger_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <!--<wgt:menu-item id="ins_chronic" label="Хронический больной" default="false" context="true">-->

                                <!--<wgt:invoke-action action-id="chronic" confirmation="false"/>-->
                                <!--<wgt:conditions>-->
                                <!--<wgt:visibility-condition>-->
                                <!--<wgt:expression>has_chronic != true</wgt:expression>-->
                                <!--</wgt:visibility-condition>-->
                                <!--</wgt:conditions>-->
                                <!--</wgt:menu-item>-->

                                <!--<wgt:menu-item id="del_chronic" label="Снятие Хронического больного" default="false" context="true">-->

                                <!--<wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"-->
                                <!--detail-field-id="call_id" refresh-on-close="true" width="475px">-->
                                <!--<wgt:pre-filters>-->
                                <!--<wgt:pre-filter field-id="note.id" ref="chronic_id"/>-->
                                <!--<wgt:pre-filter field-id="note.name" ref="chronic_name"/>-->
                                <!--</wgt:pre-filters>-->
                                <!--</wgt:show-modal>-->

                                <!--<wgt:conditions>-->
                                <!--<wgt:visibility-condition>-->
                                <!--<wgt:expression>has_chronic != false</wgt:expression>-->
                                <!--</wgt:visibility-condition>-->
                                <!--</wgt:conditions>-->
                                <!--</wgt:menu-item>-->

                                <wgt:menu-item id="ins_psycho" label="Псих. больной (Alt+0)" key="Alt+0" default="false"
                                               context="true">

                                    <wgt:invoke-action action-id="psycho" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_psycho" label="Снятие Псих. больного (Alt+0)" key="Alt+0"
                                               default="false" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку псих. больного с вызова №{queue.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="psycho_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="psycho_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="note_history" label="История отметок (Alt+H)" key="Alt+H"
                                               default="false" context="true">
                                    <wgt:show-modal page-id="note_history" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" width="600px"
                                                    page-name="История отметок вызова №{queue.number}"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(has_note == true)</wgt:expression>
                                            <wgt:tooltip>Отметок не установлено</wgt:tooltip>
                                        </wgt:enabling-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                            </wgt:sub-menu>
                        </wgt:menu-item>

                        <wgt:menu-item id="speedUp" label="Ускорить" context="true" key="Alt+Y" icon="icon-arrow-up"
                                       type="icon">
                            <!--<wgt:invoke-action action-id="speedUp" confirmation="false"/>-->
                            <wgt:show-modal page-id="speedUp" container-id="single" master-field-id="id"
                                            detail-field-id="call_id" refresh-on-close="true" width="475px"
                                            page-name="Ускорить вызов №{queue.number}"/>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression>has_speedUp != true</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                        <wgt:menu-item id="speedDown" label="Не срочно" context="true" key="Alt+C"
                                       icon="icon-arrow-down" type="icon">
                            <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"
                                            detail-field-id="call_id" refresh-on-close="true" width="475px"
                                            page-name="Снять отметку ускорения вызова №{queue.number}">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="note.id" ref="speedUp_id"/>
                                    <wgt:pre-filter field-id="note.name" ref="speedUp_name"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression>has_speedUp != false</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <!--<wgt:menu-item id="note" label="Отметки(Alt+6)" default="false" key="Alt+6" context="true">-->
                        <!--<wgt:show-modal page-id="call_note" container-id="single" master-field-id="id" detail-field-id="call_id" refresh-on-close="true" width="475px"/>-->
                        <!--</wgt:menu-item>-->

                        <wgt:menu-item id="history" label="История вызова (Alt+I)" context="true" key="Alt+I"
                                       icon="icomoon-history" type="icon">
                            <!--<wgt:show-modal page-id="history" container-id="state" master-field-id="id" detail-field-id="id"/>-->
                            <wgt:show-modal page-id="history" container-id="call" master-field-id="id"
                                            detail-field-id="id" width="850px"
                                            page-name="История вызова №{queue.number}"/>
                        </wgt:menu-item>

                        <wgt:menu-item id="processing" label="Отработка вызова" context="true" key="Alt+P">
                            <wgt:show-modal page-id="processing" master-field-id="processing_profile.id"
                                            detail-field-id="profileId"
                                            page-name="Отработка вызова №{queue.number}" width="800px"
                                            refresh-on-close="true">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="profileId" ref="processing_profile.id"
                                                    container-id="team"/>
                                    <wgt:pre-filter field-id="callId" ref="id" container-id="team"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <!--<wgt:conditions>-->
                            <!--<wgt:enabling-condition>-->
                            <!--<wgt:expression>(typeof id != 'undefined')&amp;&amp;(id != null)</wgt:expression>-->
                            <!--<wgt:tooltip>Нет вызова</wgt:tooltip>-->
                            <!--</wgt:enabling-condition>-->
                            <!--</wgt:conditions>-->
                        </wgt:menu-item>
                    </wgt:action-menu>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="is_opened" value="true"/>
                </pre-filters>
            </container>
        </region>
        <region place="right" type="none">
            <container id="top_team" place="top" depends-on="team">
                <wgt:form master-field-id="id" detail-field-id="id" src="ext/css/amb03-control-container-queue"
                          customize="css" css-class="card-queue">
                    <wgt:name>Информация о бригаде</wgt:name>
                    <wgt:query-id>brg</wgt:query-id>
                    <fs:field-set>
                        <fs:row>
                            <ctrl:output-text id="name" readonly="true" css-class="ambqueue-brg grey-label"/>
                            <!-- новое  -->
                            <ctrl:output-text id="md_profile.name" label="" readonly="true"
                                              css-class="ambqueue-profile grey-label"/>
                        </fs:row>
                        <fs:row>
                            <!--<ctrl:output-text id="name" readonly="true" css-class="ambqueue-brg grey-label"/>-->
                            <!--<ctrl:output-text id="change.data" readonly="true" css-class="ambqueue-data grey-label"/>-->
                            <ctrl:output-text id="change.from_dt" label="c" readonly="true"
                                              css-class="ambqueue-from_dt grey-label"/>
                            <ctrl:output-text id="change.to_dt" label="по" readonly="true"
                                              css-class="ambqueue-to_dt grey-label"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:output-text id="team_job_resource.name" label="Старший" readonly="true"
                                              css-class="ambqueue-team_job_resource grey-label"/>
                            <ctrl:output-text id="note" label="Прим." readonly="true"
                                              css-class="ambqueue-note grey-label"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:output-text id="job_status.name" readonly="true"
                                              css-class="ambqueue-job_status grey-label"/>
                            <ctrl:output-text id="stat_time" label="Время" readonly="true"
                                              css-class="ambqueue-stat_time grey-label"/>
                        </fs:row>
                        <fs:row>
                            <!--<ctrl:output-text id="lab" label="" css-class="ambqueue-lab">-->
                            <!--<ctrl:set-value-expression>endmes||readymes</ctrl:set-value-expression>-->
                            <!--</ctrl:output-text>-->
                            <ctrl:output-text id="control_time" label="Контр. вр." readonly="true"
                                              css-class="ambqueue-control_time grey-label"/>
                            <ctrl:output-text id="endmes" label="" css-class="ambqueue-mes"
                                              dependency-condition="(endmes != '')"/>
                            <ctrl:output-text id="readymes" label="" css-class="ambqueue-mes"
                                              dependency-condition="(readymes != '')"/>
                        </fs:row>
                    </fs:field-set>
                </wgt:form>
            </container>

            <container id="team" place="bottom" depends-on="parent" refresh-dependent-container="true">
                <wgt:table master-field-id="id" detail-field-id="par_id" customize="js" src="ext/js/autoRefreshTable">
                    <!--<wgt:table customize="js" src="ext/css/refreshTable">-->
                    <wgt:query-id>brg</wgt:query-id>
                    <wgt:name>Бригады</wgt:name>
                    <wgt:size>20</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="name" width="35px">
                            <wgt:color color-field-id="jscolor.id"/>
                        </wgt:column>
                        <wgt:column column-field-id="call.number" width="40px"/>
                        <wgt:column column-field-id="job_status.name" width="50px">
                            <wgt:color color-field-id="jscolor.id"/>
                        </wgt:column>
                        <!--<wgt:column column-field-id="stat_time" width="50px"/>-->
                        <wgt:column column-field-id="control_time" width="50px">
                            <wgt:color>
                                <wgt:switch value-field-id="is_control_time">
                                    <wgt:case value="true">text-error</wgt:case>
                                    <wgt:default>text</wgt:default>
                                </wgt:switch>
                            </wgt:color>
                        </wgt:column>
                        <wgt:column column-field-id="address" width="150px"/>
                        <!--<wgt:column column-field-id="team_job_resource.res_name" width="150px"/>-->
                        <!--<wgt:column column-field-id="brg_call" width="50px"/>-->
                    </wgt:columns>
                    <!--<wgt:rows>-->
                    <!--<wgt:color color-field-id="jscolor.id"/>-->
                    <!--</wgt:rows>-->
                    <wgt:sortings>
                        <wgt:sorting sorting-field-id="stat_time" direction="ASC"/>
                    </wgt:sortings>
                    <wgt:filters position="top" opened="false">
                        <ctrl:input-text id="name"/>
                    </wgt:filters>
                    <wgt:action-menu>
                        <!--<wgt:menu-item id=""-->

                        <wgt:menu-item id="status" label="Статус">
                            <wgt:sub-menu>
                                <wgt:menu-item id="free" label="Свободна (Alt+6)" key="Alt+6" context="true">
                                    <wgt:invoke-action action-id="free" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 1)&amp;&amp;(job_status.id != 7) &amp;&amp;
                                                (is_amb == false)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id != 2) &amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="free2" label="Свободна (Alt+6)" key="Alt+6" context="true">
                                    <wgt:invoke-action action-id="close_call" confirmation="true"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 1)&amp;&amp;(job_status.id != 7) ||
                                                (is_amb == true)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2) || (is_amb == true)</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="repair" label="На ремонте (Alt+7)" key="Alt+7" context="true">
                                    <wgt:invoke-action action-id="repair" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp;(job_status.id != 3)&amp;&amp;(job_status.id
                                                != 7)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="lunch" label="На обеде (Alt+8)" key="Alt+8" context="true">
                                    <wgt:invoke-action action-id="lunch" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp;(job_status.id != 4)&amp;&amp;(job_status.id
                                                != 7)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="refueling" label="Заправка (Alt+9)" key="Alt+9" context="true">
                                    <wgt:invoke-action action-id="refueling" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp;(job_status.id != 5)&amp;&amp;(job_status.id
                                                != 7)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id != 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <!--если бригада на вызове-->
                                <wgt:menu-item id="close_call" label="Завершить (Alt+2)" key="Alt+2" context="true">
                                    <wgt:invoke-action action-id="close_call" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2) || (is_amb == true)</wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2) || (is_amb == true)</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="exitfromsubstation" label="Выезд (Alt+3)" key="Alt+3" context="true">
                                    <wgt:invoke-action action-id="exitfromsubstation" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;(last_state != 6)&amp;&amp;(last_state
                                                != 7)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="arrival" label="Доезд (Alt+4)" key="Alt+4" context="true">
                                    <wgt:invoke-action action-id="arrival" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;(last_state != 7)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="beginTransport" label="Начало транспортировки (Alt+8)" key="Alt+8"
                                               context="true">
                                    <wgt:invoke-action action-id="beginTransport" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;((last_state ==
                                                7)||(last_state == 6)||(last_state == 9))
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;(is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="comingToMO" label="Прибытие в МО (Alt+9)" key="Alt+9" context="true">
                                    <wgt:invoke-action action-id="comingToMO" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;((last_state ==
                                                8)||(last_state == 6))
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp;(is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <!--написать изменение адреса-->
                                <wgt:menu-item id="returntosubstation1" label="Возврат на п/ст (Alt+0)" key="Alt+0"
                                               context="true">
                                    <wgt:invoke-action action-id="returntosubstation" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id != 3)&amp;&amp;(job_status.id != 4)&amp;&amp;(job_status.id
                                                != 5)&amp;&amp;(job_status.id != 7)&amp;&amp;(address != null)
                                            </wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(is_amb == false)&amp;&amp;(job_status.id == 2)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <!--<wgt:menu-item id="returntosubstation_free" label="Возврат на п/ст (Alt+0)2" key="Alt+0" context="true">-->
                                <!--<wgt:invoke-action action-id="returntosubstation_free" confirmation="false"/>-->
                                <!--<wgt:conditions>-->
                                <!--<wgt:enabling-condition>-->
                                <!--<wgt:expression>(job_status.id != 3)&amp;&amp;(job_status.id != 4)&amp;&amp;(job_status.id != 5)&amp;&amp;(job_status.id != 7)&amp;&amp;(address != null)</wgt:expression>-->
                                <!--</wgt:enabling-condition>-->
                                <!--<wgt:visibility-condition>-->
                                <!--<wgt:expression>(is_amb == false)&amp;&amp;(job_status.id != 2)</wgt:expression>-->
                                <!--</wgt:visibility-condition>-->
                                <!--</wgt:conditions>-->
                                <!--</wgt:menu-item>-->

                                <wgt:menu-item id="annul" label="Снять (Alt+5)" context="true" key="Alt+5">
                                    <wgt:invoke-action action-id="annul" confirmation="true"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(job_status.id == 2)</wgt:expression>
                                        </wgt:enabling-condition>
                                        <wgt:visibility-condition>
                                            <wgt:expression>(job_status.id == 2)&amp;&amp; (is_amb == false)
                                            </wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                            </wgt:sub-menu>
                        </wgt:menu-item>

                        <wgt:menu-item id="transfer" label="Посыл (Alt+1)" context="true" default="false" key="Alt+1">
                            <wgt:show-modal page-id="transfer_call" action-id="transfer" width="300px" model="default"
                                            master-field-id="brg.id" detail-field-id="brg.id"
                                            page-name="Посыл бригады '{team.name}' на вызов №{queue.number}">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="call_id" value="{amb.queue.queue:id}"/>
                                    <wgt:pre-filter field-id="number" value="{amb.queue.queue:number}"/>
                                    <wgt:pre-filter field-id="brg.id" value="{amb.queue.team:brg.id}"/>
                                    <wgt:pre-filter field-id="brg.name" value="{amb.queue.team:name}"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <!--todo условие на существовании рекомендации на бригаду-->
                                <wgt:enabling-condition>
                                    <wgt:expression>((job_status.id == 1) || (job_status.id == null))</wgt:expression>
                                    <wgt:tooltip>Нельзя послать бригаду на вызов</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="queue_notes" label="Отметки">
                            <wgt:sub-menu>

                                <wgt:menu-item id="citi1" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="in_cityservice" container-id="top"
                                                    master-field-id="call.id"
                                                    detail-field-id="call_id" width="715px" refresh-on-close="true"
                                                    page-name="Передача вызова №{team.call.number} в службы города">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="call_note.type" value="true"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="citi2" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal action-id="create" page-id="in_cityservice_ins"
                                                    container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id"
                                                    width="715px" refresh-on-close="true"
                                                    page-name="Передача вызова №{team.call.number} в службы города"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="selfrefused" label="Самоотказ(Alt+2)" key="Alt+2" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="selfrefused" container-id="single"
                                                    master-field-id="call.id"
                                                    detail-field-id="call_id" width="545px" refresh-on-close="true"
                                                    page-name="Самоотказ на вызове №{team.call.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="doctor_refusal" label="Отказ врача(Alt+3)" key="Alt+3" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="doctor_refusal" container-id="single"
                                                    master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Отказ врача на вызове №{team.call.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="alcoholization" label="Алкогольное опьянение (Alt+3)" key="Alt+3"
                                               context="true" default="false">
                                    <wgt:invoke-action action-id="alcohol" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_alcoholization" label="Снятие Алкогольного опьянения (Alt+3)"
                                               key="Alt+3" context="true" default="false">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку Алкогольного опьянения с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="alco_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="alco_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="hospitalization" label="Госпитализация(Alt+4)" key="Alt+4"
                                               context="true" default="false">
                                    <wgt:show-modal page-id="hospitalization" container-id="single"
                                                    master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="600px"
                                                    page-name="Госпитализация больного на вызове № {team.call.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="double" label="Повторный/задвоенный(Alt+5)" default="false"
                                               key="Alt+5" context="true">
                                    <wgt:show-modal page-id="call_double" container-id="top" master-field-id="call.id"
                                                    detail-field-id="id" refresh-on-close="true" width="700px"
                                                    page-name="Повторность/Задвоенность вызова № {team.call.number}"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_road_accident" label="ДТП (Alt+6)" default="false" key="Alt+6" context="true">

                                    <wgt:invoke-action action-id="road_acc" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_road_accident" label="Снятие ДТП (Alt+6)" default="false" key="Alt+6" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку ДТП с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="road_acc_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="road_acc_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_fire" label="Пожар (Alt+7)" default="false" key="Alt+7" context="true">
                                    <wgt:invoke-action action-id="fire" confirmation="false"/>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_fire" label="Снятие Пожара (Alt+7)" default="false" key="Alt+7" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку пожара с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="fire_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="fire_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_crime" label="Криминал (Alt+8)" default="false" key="Alt+8" context="true">
                                    <wgt:invoke-action action-id="crime" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_crime" label="Снятие Криминала (Alt+8)" default="false" key="Alt+8" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку криминала с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="crime_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="crime_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_dang" label="Особо опасный объект (Alt+9)" default="false" key="Alt+9" context="true">

                                    <wgt:invoke-action action-id="danger" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_dang" label="Снятие Особо опасного объекта (Alt+9)" default="false" key="Alt+9" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку особо опасного объекта с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="danger_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="danger_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_psycho" label="Псих. больной (Alt+0)" key="Alt+0" default="false" context="true">

                                    <wgt:invoke-action action-id="psycho" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_psycho" label="Снятие Псих. больного (Alt+0)" key="Alt+0" default="false" context="true">

                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку псих. больного с вызова № {team.call.number}">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="psycho_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="psycho_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>

                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="note_history" label="История отметок (Alt+H)" key="Alt+H" default="false" context="true">
                                    <wgt:show-modal page-id="note_history" container-id="single" master-field-id="call.id"
                                                    detail-field-id="call_id" width="600px"
                                                    page-name="История отметок вызова № {team.call.number}"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(has_note == true)</wgt:expression>
                                            <wgt:tooltip>Отметок не установлено</wgt:tooltip>
                                        </wgt:enabling-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                            </wgt:sub-menu>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>(job_status.id == 2)</wgt:expression>
                                    <wgt:tooltip>Нельзя открыть меню отметок</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="queue_update" label="КВ" context="true" key="Enter" default="false">
                            <wgt:show-modal page-id="call_upd" width="925px" refresh-on-close="true"
                                            result-container-id="call"
                                            master-field-id="call.id" detail-field-id="id"
                                            page-name="Изменить карту вызова диспетчера № {team.call.number}"
                                            action-id="update"/>
                            <wgt:properties>
                                <wgt:property key="security-replace" value="read"/>
                            </wgt:properties>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>(job_status.id == 2)</wgt:expression>
                                    <wgt:tooltip>Нельзя открыть карту вызова</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="hist" label="История" context="true" key="Alt+S">
                            <wgt:show-modal page-id="job_status_hist" result-container-id="job_hist"
                                            master-field-id="brg.id" detail-field-id="team_job.id" width="600px"
                                            page-name="История статусов бригады {team.name} ({team.change.data})"/>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>is_amb == false</wgt:expression>
                                    <wgt:tooltip>Вызов обслужен специалистом</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="team_relationship" label="Состав" context="true" key="Alt+R">
                            <wgt:show-modal page-id="team_relationship" width="600px" master-field-id="brg.id"
                                            detail-field-id="brg_id"
                                            page-name="Состав бригады {team.name} ({team.change.data})"/>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>is_amb == false</wgt:expression>
                                    <wgt:tooltip>Вызов АМБ</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                        <!--<wgt:menu-item id="catered_call" label="Обслуженные вызовы" context="true">-->
                        <!--<wgt:show-modal page-id="catered_call" width="1000px" master-field-id="brg.id" detail-field-id="id"/>-->
                        <!--</wgt:menu-item>-->
                        <wgt:menu-item id="catered_call" label="Обслужено" context="true" key="Alt+C">
                            <wgt:show-modal page-id="catered_call" width="1050px"
                                            page-name="Вызовы, обслуженные бригадой {team.name} ({team.change.data})"
                                            master-field-id="brg.id" detail-field-id="brg.id">
                                <!--<wgt:pre-filters>-->
                                <!--<wgt:pre-filter field-id="brg.id" ref="id"/>-->
                                <!--</wgt:pre-filters>-->
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="aa" label="СПЦ/Акт">

                            <wgt:sub-menu>
                                <wgt:menu-item id="spc" label="Вызов СПЦ" context="false" type="icon">
                                    <wgt:show-modal page-id="call_ins" width="925px" refresh-on-close="true"
                                                    result-container-id="call"
                                                    page-name="Создать карту вызова диспетчера" action-id="create"
                                                    focus-after-submit="false">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="change.id" ref="actual_change.id"/>
                                            <wgt:pre-filter field-id="change.data" ref="actual_change.data"/>
                                            <wgt:pre-filter field-id="call_kind.id" value="5"/>
                                            <wgt:pre-filter field-id="call_type.id" value="1"/>
                                            <wgt:pre-filter field-id="parbrg.id" value="{amb.queue.team:brg.id}"/>
                                            <wgt:pre-filter field-id="parent_call.id" value="{amb.queue.team:call.id}"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                </wgt:menu-item>
                                <wgt:menu-item id="active" label="Активный" context="false" type="icon">
                                    <wgt:show-modal page-id="call_ins" width="925px" refresh-on-close="true"
                                                    result-container-id="call"
                                                    page-name="Создать карту вызова диспетчера" action-id="create"
                                                    focus-after-submit="false">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="change.id" ref="actual_change.id"/>
                                            <wgt:pre-filter field-id="change.data" ref="actual_change.data"/>
                                            <wgt:pre-filter field-id="call_kind.id"
                                                            value="{amb.queue.team:call_kind.id}"/>
                                            <wgt:pre-filter field-id="call_type.id" value="3"/>
                                            <wgt:pre-filter field-id="parbrg.id" value="{amb.queue.team:brg.id}"/>
                                            <wgt:pre-filter field-id="parent_call.id" value="{amb.queue.team:call.id}"/>
                                            <wgt:pre-filter field-id="date" value="{amb.queue.team:change.data}"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                </wgt:menu-item>
                            </wgt:sub-menu>
                        </wgt:menu-item>
                    </wgt:action-menu>
                </wgt:table>
                <pre-filters>
                    <!--<pre-filter field-id="change.id" value="#{change.id?}"/>-->
                    <pre-filter field-id="is_edate" value="false"/>
                    <!--<pre-filter field-id="" value=""-->
                </pre-filters>
            </container>
        </region>
        <region place="top" type="none">
            <container id="parent">
                <!--<wgt:form style="visibility: hidden;height: 0">-->
                <wgt:form>
                    <wgt:query-id>queue</wgt:query-id>
                </wgt:form>
            </container>
        </region>
    </regions>
</page>