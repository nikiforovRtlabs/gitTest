<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-1.0"
      xmlns:ctrl="http://n2oapp.net/framework/config/schema/n2o-control-1.0"
      xmlns:wgt="http://n2oapp.net/framework/config/schema/n2o-widget-2.0"
      xmlns:fs="http://n2oapp.net/framework/config/schema/fieldset-2.0"
      xmlns:rc="http://atria.cz/app/config/schema/rmis-control-1.0">
    <!--<id>dispjournal</id>-->
    <name>Журнал вызовов Диспетчера03</name>
    <object-id>dispjournal</object-id>
    <layout>n2o/layout/single</layout>
    <regions>
        <region place="top" type="none">
            <container id="clinicReportSettings" refresh-dependent-container="true">
                <wgt:edit-form style="height: 0px;">
                    <wgt:query-id>mdClinicReportSettings</wgt:query-id>
                    <wgt:model>query-or-default</wgt:model>
                </wgt:edit-form>
                <pre-filters>
                    <pre-filter field-id="orgId" value="#{org.id}"/>
                </pre-filters>
            </container>
        </region>
        <region place="single" type="list">
            <container id="top" place="top" depends-on="journ" opened="true">
                <wgt:form master-field-id="id" detail-field-id="id" src="ext/css/amb03-journals" customize="css" css-class="dispjour">
                    <wgt:name>Информация о вызове</wgt:name>
                    <wgt:query-id>top_journals</wgt:query-id>
                    <fs:field-set css-class="dispjour-block-left">
                        <fs:row>
                            <ctrl:input-text id="phone" readonly="true"
                                             css-class="dispjour-phone" label-style="width:85px;"/>
                            <ctrl:input-text id="employee.namePos" label="Принял" readonly="true"
                                             css-class="dispjour-remp" control-style="width:200px" label-style="width:45px;"/>
                            <ctrl:input-text id="from_time" label="Принят" readonly="true"
                                             css-class="dispjour-from_time" label-style="width:65px;"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:input-text id="address.name" readonly="true"
                                             css-class="dispjour-address" control-style="width:385px" label-style="width:85px;"/>
                            <ctrl:input-text id="state_history.datetime" label="Время" readonly="true"
                                             css-class="dispjour-state_history" label-style="width:65px;"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:input-text id="descr" readonly="true"
                                             css-class="dispjour-descr" control-style="width:385px" label-style="width:85px;"/>
                            <ctrl:input-text id="call_state.name" readonly="true"
                                             css-class="dispjour-call_state" label-style="width:65px;"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:input-text id="caller_reason.name" readonly="true"
                                             dependency-condition="call_kind.id != 3 &amp;&amp; call_kind.id != 4"
                                             css-class="dispjour-caller_reason" control-style="width:385px" label-style="width:85px;"/>
                            <ctrl:input-text id="diagnosis.codename" readonly="true"
                                             dependency-condition="call_kind.id == 3 || call_kind.id == 4"
                                             css-class="dispjour-diagnosis" control-style="width:385px" label-style="width:85px;"/>
                            <ctrl:input-text id="time" label="Длит-сть" readonly="false"
                                             dependency-condition="call_state.name != 'окончание вызова'"
                                             css-class="dispjour-time" label-style="width:65px;"/>
                            <ctrl:input-text id="calltime" label="Время обсл-я" readonly="false"
                                             dependency-condition="call_state.name == 'окончание вызова'"
                                             css-class="dispjour-calltime" label-style="width:65px;"/>
                        </fs:row>
                    </fs:field-set>
                    <fs:field-set field-label-location="top" css-class="dispjour-block-right">
                        <ctrl:text-area id="notes" readonly="true" rows="6" label="Примечание"
                                        css-class="dispjour-notes"/>
                    </fs:field-set>
                </wgt:form>
            </container>
            <container id="journ" place="bottom" depends-on="clinicReportSettings">
                <wgt:table detail-field-id="time_begin" master-field-id="time_begin">
                    <wgt:query-id>dispjournal</wgt:query-id>
                    <wgt:name>Журнал вызовов</wgt:name>
                    <wgt:size>20</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="number" width="35px"/>
                        <wgt:column column-field-id="call_kind.code" width="25px">
                            <wgt:color color-field-id="priority.color"/>
                        </wgt:column>
                        <wgt:column column-field-id="notes" width="30px"/>
                        <wgt:column column-field-id="ftime" width="40px"/>
                        <wgt:column column-field-id="address.name" width="150px"/>
                        <wgt:column column-field-id="patFIO" width="150px"/>
                        <wgt:column column-field-id="age" width="50px"/>
                        <wgt:column column-field-id="reason" width="150px"/>
                        <wgt:column column-field-id="brg.name" width="50px"/>
                        <wgt:column column-field-id="priorNum" width="110px"/>
                    </wgt:columns>
                    <wgt:sortings>
                        <wgt:sorting sorting-field-id="from_time" direction="DESC"/>
                    </wgt:sortings>
                    <wgt:filters position="left" opened="true">
                        <ctrl:date-interval id="todayDate" label="Дата вызова" popup-placement="down,right" dependency-condition="isToDay == true">
                            <ctrl:default-model begin="today()" end="tomorrow()"/>
                            <ctrl:set-value-expression on="todayDate,timeBegin,timeEnd" on-load="false">
                                <![CDATA[
                                    var o = todayDate;
                                    var regex = new RegExp('([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]');
                                    if((typeof timeBegin != 'undefined') && (timeBegin != null) && (typeof todayDate.begin != 'undefined') && (todayDate.begin != null)){
                                        if(!regex.test(timeBegin)){
                                            timeBegin = '00:00:00';
                                        }
                                        o.begin = o.begin.substring(0, 11) + timeBegin;
                                    }
                                    if((typeof timeEnd != 'undefined') && (timeEnd != null) && (typeof todayDate.end != 'undefined') && (todayDate.end != null)){
                                        if(!regex.test(timeEnd)){
                                            timeEnd = '00:00:00';
                                        }
                                        o.end = o.end.substring(0, 11) + timeEnd;
                                    }
                                    o;
                                ]]>
                            </ctrl:set-value-expression>
                        </ctrl:date-interval>
                        <ctrl:date-interval id="yesterdayDate" label="Дата вызова" popup-placement="down,right" dependency-condition="isToDay == false">
                            <ctrl:default-model begin="yesterday()" end="today()"/>
                            <ctrl:set-value-expression on="yesterdayDate,timeBegin,timeEnd" on-load="false">
                                <![CDATA[
                                    var o = yesterdayDate;
                                    var regex = new RegExp('([0-1][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]');
                                    if((typeof timeBegin != 'undefined') && (timeBegin != null) && (typeof yesterdayDate.begin != 'undefined') && (yesterdayDate.begin != null)){
                                        if(!regex.test(timeBegin)){
                                            timeBegin = '00:00:00';
                                        }
                                        o.begin = o.begin.substring(0, 11) + timeBegin;
                                    }
                                    if((typeof timeEnd != 'undefined') && (timeEnd != null) && (typeof yesterdayDate.end != 'undefined') && (yesterdayDate.end != null)){
                                        if(!regex.test(timeEnd)){
                                            timeEnd = '00:00:00';
                                        }
                                        o.end = o.end.substring(0, 11) + timeEnd;
                                    }
                                    o;
                                ]]>
                            </ctrl:set-value-expression>
                        </ctrl:date-interval>
                        <ctrl:masked-input id="timeBegin" label="начало" mask="99:99:99">
                            <!--todo временное решение RMISDEV-5020 required="true" срабатывает раньше установки значения в результате ошибка-->
                            <!--required="true"-->
                            <ctrl:validations>
                                <ctrl:validation ref-id="checkTimeBeginNotNull"/>
                                <ctrl:validation ref-id="checkTimeBegin"/>
                            </ctrl:validations>
                            <ctrl:set-value-expression on-load="true" on-non-empty="false">time_begin</ctrl:set-value-expression>
                        </ctrl:masked-input>
                        <ctrl:masked-input id="timeEnd" label="окончание" mask="99:99:99">
                            <!--todo временное решение RMISDEV-5020 required="true" срабатывает раньше установки значения в результате ошибка-->
                            <!--required="true"-->
                            <ctrl:validations>
                                <ctrl:validation ref-id="checkTimeEndNotNull"/>
                                <ctrl:validation ref-id="checkTimeEnd"/>
                            </ctrl:validations>
                            <ctrl:set-value-expression on-load="true" on-non-empty="false">time_end</ctrl:set-value-expression>
                        </ctrl:masked-input>
                        <ctrl:input-text id="number"/>
                        <ctrl:classifier id="call_place" label="Место вызова" search-as-you-type="true">
                            <ctrl:query query-id="call_place" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="org" label="Организация" search-as-you-type="true" dependency-condition="call_place.search == true">
                            <ctrl:query query-id="amborg" value-field-id="id" label-field-id="name">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="PRId" ref="call_place.PRId"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                        </ctrl:classifier>
                        <ctrl:classifier id="address" label="Адрес: улица" search-as-you-type="true">
                            <ctrl:query query-id="addr_elem" value-field-id="id" label-field-id="search_name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="priority" label="Приоритет" search-as-you-type="true">
                            <ctrl:query query-id="priority" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="call_kind" label="Вид" search-as-you-type="true">
                            <ctrl:query query-id="call_kind" value-field-id="id" label-field-id="code"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="call_type" label="Тип" search-as-you-type="true">
                            <ctrl:query query-id="call_type" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="call_reason" label="Причина" search-as-you-type="true">
                            <ctrl:query query-id="call_reason" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <!--<ctrl:classifier id="caller_reason" label="Повод" dependency-condition="(call_kind.id == null)||(call_kind.id != 3)&amp;&amp;(call_kind.id !=4)">-->
                        <!--<ctrl:classifier id="caller_reason" label="Повод" dependency-condition="call_kind != null">-->
                        <ctrl:classifier id="caller_reason" label="Повод" search-as-you-type="true"
                                         dependency-condition="(typeof call_kind == 'undefined') || (call_kind == null) || ((call_kind.id != 3)&amp;&amp;(call_kind.id !=4))">
                            <ctrl:query query-id="caller_reason" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="diagnosis" label="Диагноз" search-as-you-type="true"
                                         dependency-condition="(call_kind.id == 3)||(call_kind.id ==4)">
                            <ctrl:query query-id="amb_diagnosis" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="reason_accident" label="Причина НС" search-as-you-type="true"
                                         dependency-condition="call_reason.id ==1">
                            <ctrl:query query-id="reason_accident" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <!--<rc:patient id="individual" label="Пациент"/>-->
                        <ctrl:input-text id="individual.surname" label="Пациент: Фамилия"/>
                        <ctrl:input-text id="individual.name" label="Пациент: Имя"/>
                        <ctrl:input-text id="individual.patrName" label="Пациент: Отчество"/>
                        <!--<ctrl:checkbox-group id="note" label="Отметки">-->
                        <!--<ctrl:options>-->
                        <!--<ctrl:option>{"id":1, "name":"ЧС"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":3, "name":"ДТП"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":11, "name":"город"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":13, "name":"МО"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":10, "name":"Со"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":20, "name":"ов"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":8, "name":"задв"}</ctrl:option>-->
                        <!--<ctrl:option>{"id":9, "name":"повт"}</ctrl:option>-->
                        <!--&lt;!&ndash;<ctrl:option>{"id": ,}</ctrl:option>&ndash;&gt;-->
                        <!--</ctrl:options>-->
                        <!--</ctrl:checkbox-group>-->
                        <!--<ctrl:checkbox-group id="note" label="Отметки">-->
                        <!--<ctrl:query query-id="note" label-field-id="name" value-field-id="id"/>-->
                        <!--</ctrl:checkbox-group>-->

                        <!--<ctrl:classifier id="caller" label="Кто вызвал" search-as-you-type="true">-->
                            <!--<ctrl:query query-id="caller" value-field-id="id" label-field-id="name"/>-->
                        <!--</ctrl:classifier>-->
                        <ctrl:classifier id="employee_med" label="Сотрудник МО" search-as-you-type="true" dependency-condition="(org.id != null)">
                            <ctrl:query query-id="employee" value-field-id="id" label-field-id="name">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="orgId" ref="org.id"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                        </ctrl:classifier>
                        <ctrl:classifier id="team" label="Бригада">
                            <ctrl:query query-id="res_team" value-field-id="id" label-field-id="name">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="station.id" value="#{org.id?}"/>
                                    <ctrl:pre-filter field-id="substation.id" ref="substation.id"/>
                                    <ctrl:pre-filter field-id="edate" type="isNull"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                        </ctrl:classifier>
                        <ctrl:classifier id="station" label="Станция" readonly="true">
                            <ctrl:query query-id="station" value-field-id="id" label-field-id="name"/>
                            <ctrl:default-model>
                                <ctrl:value field-id="id">#{org.id?}</ctrl:value>
                                <ctrl:value field-id="name">#{org.name?}</ctrl:value>
                            </ctrl:default-model>
                        </ctrl:classifier>
                        <ctrl:classifier id="substation" label="Подстанция" search-as-you-type="true">
                            <ctrl:query query-id="substation" value-field-id="id" label-field-id="name">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="dorgId" ref="station.id"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                            <ctrl:default-model>
                                <ctrl:value field-id="id">#{dep.id?}</ctrl:value>
                                <ctrl:value field-id="name">#{dep.name?}</ctrl:value>
                            </ctrl:default-model>
                        </ctrl:classifier>
                        <ctrl:input-text id="priorNum" domain="integer" min="0" max="99"/>

                        <!--<ctrl:classifier id="brg"-->
                        <!--<ctrl:classifier id="employee"-->
                    </wgt:filters>
                    <wgt:action-menu>
                        <wgt:menu-item id="create" label="Создать (Ins)" context="false" key="Insert">
                            <wgt:show-modal page-id="call_ins" width="980px" refresh-on-close="true" result-container-id="call"
                                            after-submit="closeModal" page-name="Создать карту вызова диспетчера" action-id="create">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="change.id" ref="actual_change.id"/>
                                    <wgt:pre-filter field-id="change.data" ref="actual_change.data"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="read" label="Просмотр" context="true" default="true" key="Alt+Enter" visible="false" icon="glyphicons glyphicons-display" type="textAndIcon">
                            <wgt:show-modal page-id="call_upd" width="980px"/>
                        </wgt:menu-item>
                        <wgt:menu-item id="update" label="Изменить (Enter)" context="true" default="true" key="Enter">
                            <wgt:show-modal page-id="call_upd" width="980px" refresh-on-close="true" result-container-id="call"
                                    page-name="Изменить карту вызова диспетчера №{journ.number}" action-id="update">
                            </wgt:show-modal>
                            <wgt:properties>
                                <wgt:property key="security-replace" value="read"/>
                            </wgt:properties>
                        </wgt:menu-item>
                        <wgt:menu-item id="delete" label="Удалить(Del)" context="true" key="Delete">
                            <wgt:invoke-action action-id="delete"/>
                        </wgt:menu-item>
                        <wgt:menu-item id="notes" label="Отметки">
                            <wgt:sub-menu>
                                <wgt:menu-item id="citi1" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal page-id="in_cityservice" container-id="top" master-field-id="id"
                                                    detail-field-id="call_id" width="715px" refresh-on-close="true"
                                            page-name="Передача вызова №{journ.number} ({journ.change_date}) в службы города">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="call_note.type" value="true"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="citi2" label="Передача в службу (Alt+1)" key="Alt+1" context="true"
                                               default="false">
                                    <wgt:show-modal action-id="create" page-id="in_cityservice_ins"
                                                    container-id="single" master-field-id="id" detail-field-id="call_id"
                                                    width="715px" refresh-on-close="true"
                                            page-name="Передача вызова №{journ.number} ({journ.change_date}) в службы города"
                                            model="default"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_note_city == false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="selfrefused" label="Самоотказ(Alt+2)" key="Alt+2" context="true" default="false">
                                    <wgt:show-modal page-id="selfrefused" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" width="560px" refresh-on-close="true"
                                            page-name="Самоотказ на вызове №{journ.number} ({journ.change_date})">
                                    </wgt:show-modal>
                                </wgt:menu-item>

                                <wgt:menu-item id="alcoholization" label="Алкогольное опьянение (Alt+3)" key="Alt+3" context="true" default="false">
                                    <wgt:invoke-action action-id="alcohol" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="del_alcoholization" label="Снятие Алкогольного опьянения (Alt+3)" key="Alt+3" context="true" default="false">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку алкогольного опьянения с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="alco_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="alco_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_alcohol != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="doctor_refusal" label="Отказ врача(Alt+3)" key="Alt+3" context="true" default="false">
                                    <wgt:show-modal page-id="doctor_refusal" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" width="475px" refresh-on-close="true"
                                            page-name="Отказ врача на вызове №{journ.number} ({journ.change_date})"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="hospitalization" label="Госпитализация(Alt+4)" key="Alt+4" context="true" default="false">
                                    <wgt:show-modal page-id="hospitalization" container-id="single" master-field-id="id"
                                                    detail-field-id="call_id" refresh-on-close="true" width="600px"
                                                    page-name="Госпитализация больного на вызове №{journ.number} ({journ.change_date})"/>
                                </wgt:menu-item>

                                <wgt:menu-item id="double" label="Повторный/задвоенный(Alt+5)" default="false" key="Alt+5" context="true">
                                    <wgt:show-modal page-id="call_double" container-id="top" master-field-id="id"
                                                    detail-field-id="id" refresh-on-close="true" width="700px"
                                            page-name="Повторность/Задвоенность вызова №{journ.number} ({journ.change_date})"/>
                                    <!--<wgt:properties>-->
                                        <!--<wgt:property key="security-object" value="call"/>-->
                                    <!--</wgt:properties>-->
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_road_accident" label="ДТП (Alt+6)" default="false" key="Alt+6" context="true">
                                    <wgt:invoke-action action-id="road_acc" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="del_road_accident" label="Снятие ДТП (Alt+6)" default="false" key="Alt+6" context="true">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку ДТП с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="road_acc_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="road_acc_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_road_acc != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_fire" label="Пожар (Alt+7)" default="false" key="Alt+7" context="true">
                                    <wgt:invoke-action action-id="fire" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="del_fire" label="Снятие Пожара (Alt+7)" default="false" key="Alt+7" context="true">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку пожара с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="fire_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="fire_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_fire != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_crime" label="Криминал (Alt+8)" default="false" key="Alt+8" context="true">
                                    <wgt:invoke-action action-id="crime" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="del_crime" label="Снятие Криминала (Alt+8)" default="false" key="Alt+8" context="true">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку криминала с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="crime_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="crime_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_crime != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="ins_dang" label="Особо опасный объект (Alt+9)" default="false" key="Alt+9" context="true">
                                    <wgt:invoke-action action-id="danger" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="del_dang" label="Снятие Особо опасного объекта (Alt+9)" default="false" key="Alt+9" context="true">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку особо опасного объекта с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="danger_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="danger_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_danger != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                     <!--хроник был закоменчен-->
                                <!--<wgt:menu-item id="ins_chronic" label="Хронический больной" default="false" context="true">-->
                                    <!--<wgt:invoke-action action-id="chronic" confirmation="false"/>-->
                                    <!--<wgt:conditions>-->
                                        <!--<wgt:visibility-condition>-->
                                            <!--<wgt:expression>has_chronic != true</wgt:expression>-->
                                        <!--</wgt:visibility-condition>-->
                                    <!--</wgt:conditions>-->
                                <!--</wgt:menu-item>-->
                                <!--<wgt:menu-item id="del_chronic" label="Снятие Хронического больного" default="false" context="true">-->
                                    <!--<wgt:show-modal page-id="note_del" container-id="single" master-field-id="id"-->
                                                    <!--detail-field-id="call_id" refresh-on-close="true" width="475px">-->
                                        <!--<wgt:pre-filters>-->
                                            <!--<wgt:pre-filter field-id="note.id" ref="chronic_id"/>-->
                                            <!--<wgt:pre-filter field-id="note.name" ref="chronic_name"/>-->
                                        <!--</wgt:pre-filters>-->
                                    <!--</wgt:show-modal>-->
                                    <!--<wgt:conditions>-->
                                        <!--<wgt:visibility-condition>-->
                                            <!--<wgt:expression>has_chronic != false</wgt:expression>-->
                                        <!--</wgt:visibility-condition>-->
                                    <!--</wgt:conditions>-->
                                <!--</wgt:menu-item>-->

                                <wgt:menu-item id="ins_psycho" label="Псих. больной (Alt+0)" key="Alt+0" default="false" context="true">
                                    <wgt:invoke-action action-id="psycho" confirmation="false"/>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != true</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>
                                <wgt:menu-item id="del_psycho" label="Снятие Псих. больного (Alt+0)" key="Alt+0" default="false" context="true">
                                    <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" action-id="delete"
                                                    detail-field-id="call_id" refresh-on-close="true" width="475px"
                                                    page-name="Снять отметку псих. больного с вызова №{journ.number} ({journ.change_date})">
                                        <wgt:pre-filters>
                                            <wgt:pre-filter field-id="note.id" ref="psycho_id"/>
                                            <wgt:pre-filter field-id="note.name" ref="psycho_name"/>
                                        </wgt:pre-filters>
                                    </wgt:show-modal>
                                    <wgt:conditions>
                                        <wgt:visibility-condition>
                                            <wgt:expression>has_psycho != false</wgt:expression>
                                        </wgt:visibility-condition>
                                    </wgt:conditions>
                                </wgt:menu-item>

                                <wgt:menu-item id="note_history" label="История отметок (Alt+H)" key="Alt+H" default="false" context="true">
                                    <wgt:show-modal page-id="note_history" master-field-id="id" detail-field-id="call_id" width="600px"
                                                    page-name="История отметок вызова №{journ.number} ({journ.change_date})"/>
                                    <wgt:conditions>
                                        <wgt:enabling-condition>
                                            <wgt:expression>(has_note == true)</wgt:expression>
                                            <wgt:tooltip>Отметок не установлено</wgt:tooltip>
                                        </wgt:enabling-condition>
                                    </wgt:conditions>
                                    <!--<wgt:properties>-->
                                        <!--<wgt:property key="security-object" value="note_history"/>-->
                                    <!--</wgt:properties>-->
                                </wgt:menu-item>

                            </wgt:sub-menu>
                        </wgt:menu-item>
                        <wgt:menu-item id="speedUp" label="Ускорить" context="true" key="Alt+Y" icon="icon-arrow-up" type="text">
                            <wgt:show-modal page-id="speedUp" container-id="single" master-field-id="id" detail-field-id="call_id" refresh-on-close="true" width="475px"
                                            page-name="Ускорить вызов №{journ.number} ({journ.change_date})" action-id="speedUp">
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression>(has_speedUp != true)&amp;&amp;(brg.id == null)</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                        <wgt:menu-item id="speedDown" label="Не срочно" context="true" key="Alt+C" icon="icon-arrow-down" type="text">
                            <wgt:show-modal page-id="note_del" container-id="single" master-field-id="id" detail-field-id="call_id"
                                            refresh-on-close="true" width="475px" action-id="delete"
                                    page-name="Снять отметку ускорения вызова №{journ.number} ({journ.change_date})">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="note.id" ref="speedUp_id"/>
                                    <wgt:pre-filter field-id="note.name" ref="speedUp_name"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <!--todo надо ли условие, на то что вызов не обслужен-->
                                <wgt:visibility-condition>
                                    <wgt:expression>has_speedUp != false</wgt:expression>
                                    <!--&amp;&amp;(brg.id == null)-->
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="history" label="История вызова (Alt+I)" context="true" key="Alt+I">
                            <wgt:show-modal page-id="history" container-id="call" master-field-id="id"
                                            detail-field-id="id" width="900px"
                                            page-name="История вызова №{journ.number} ({journ.change_date})"/>
                            <wgt:properties>
                                <wgt:property key="security-object" value="call"/>
                            </wgt:properties>
                        </wgt:menu-item>

                        <wgt:menu-item id="call_card_create" label="Карта вызова(Alt+F7)1" context="true" key="Alt+F7">
                            <wgt:show-modal page-id="amb_card" action-id="create" width="930px"
                                            page-name="Создать карту вызова врача №{journ.number} ({journ.change_date})" after-submit="edit">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="id" ref="journ.id"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>(is_rendered == true) &amp;&amp; (has_card == false)</wgt:expression>
                                    <wgt:tooltip>Вызов не обслужен</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:visibility-condition>
                                    <wgt:expression>(has_card == false)</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                            <wgt:properties>
                                <wgt:property key="security-replace" value="call_card_create_read"/>
                            </wgt:properties>
                        </wgt:menu-item>
                        <wgt:menu-item id="call_card_create_read" label="Карта вызова(Alt+F7)3" context="true" key="Alt+F7">
                            <wgt:show-modal page-id="amb_card" width="930px" page-name="Создать карту вызова врача №{journ.number} ({journ.change_date})"/>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>false</wgt:expression>
                                    <wgt:tooltip>Недостаточно прав на заполнение КВ</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:visibility-condition>
                                    <wgt:expression>(has_card == false)</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                        <wgt:menu-item id="call_card_update" label="Карта вызова(Alt+F7)2" key="Alt+F7">
                            <wgt:show-modal  page-id="amb_card" action-id="update" width="930px"
                                            page-name="Изменить карту вызова врача №{journ.number} ({journ.change_date})" container-id="call" model="query" after-submit="edit">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="id" ref="journ.id"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>(is_rendered == true)&amp;&amp; (has_card == true)</wgt:expression>
                                    <wgt:tooltip>Вызов не обслужен</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:visibility-condition>
                                    <wgt:expression>(has_card == true)</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                            <wgt:properties>
                                <wgt:property key="security-replace" value="call_card_update_read"/>
                            </wgt:properties>
                        </wgt:menu-item>
                        <!--псевдокнопка КВ-->
                        <wgt:menu-item id="call_card_update_read" label="Карта вызова(Alt+F7)4" context="true" key="Alt+F7" visible="false">
                            <wgt:show-modal page-id="amb_card" width="930px" page-name="Изменить карту вызова врача №{journ.number} ({journ.change_date})"/>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>false</wgt:expression>
                                    <wgt:tooltip>Недостаточно прав на редактирование КВ</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:visibility-condition>
                                    <wgt:expression>(has_card == true)</wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <!--todo есть ли рмис-->
                        <wgt:menu-item id="EMK" context="true" label="ЭМК(Alt+E)" key="Alt+E">
                            <wgt:a href="/cases/patient/:individual.id:/case/:case.id:/edit?backUrl=" target="newWindow"/>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>is_rendered == true</wgt:expression>
                                    <wgt:tooltip>Случай обслуживания не оформлен</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>

                        <wgt:menu-item id="call_paper" label="БУМ(Alt+Insert)" context="false" key="Alt+Insert">
                            <wgt:show-modal page-id="call_paper" container-id="call_paper" action-id="create" width="930px"
                                            page-name="Карта вызова - Заполнить с бумажного носителя"/>
                        </wgt:menu-item>

                    </wgt:action-menu>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="time_end" ref="time_end"/>
                    <pre-filter field-id="isToDay" ref="isToDay"/>
                </pre-filters>
            </container>
        </region>
    </regions>
</page>