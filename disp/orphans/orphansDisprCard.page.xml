<?xml version='1.0' encoding='UTF-8'?>
<page xmlns:ctrl="http://n2oapp.net/framework/config/schema/n2o-control-1.0"
      xmlns:wgt="http://n2oapp.net/framework/config/schema/n2o-widget-1.0"
      xmlns:wgt2="http://n2oapp.net/framework/config/schema/n2o-widget-2.0"
      xmlns:fs2="http://n2oapp.net/framework/config/schema/fieldset-2.0"
      xmlns="http://n2oapp.net/framework/config/schema/page-1.0">
    <id>DisprCard</id>
    <name>Карточка диспансеризации</name>
    <object-id>orphansEventPatientDisprCard</object-id>
    <layout>n2o/layout/custom-dispr-card-orphans</layout>
    <regions>
        <region place="card" type="none">
            <container id="patientData" opened="true">
                <wgt2:form customize="js" src="n2o/widgets/custom/shortFormOrphans">
                    <wgt2:id>modelPatientCard</wgt2:id>
                    <wgt2:query-id>orphansEventPatientDisprCard</wgt2:query-id>
                    <wgt2:name>Карточка пациента</wgt2:name>
                    <wgt2:edit>
                        <wgt2:invoke-action action-id="update" />
                    </wgt2:edit>
                    <fs2:field-set field-label-location="top">
                        <fs2:row>
                            <ctrl:custom label="ФИО:" id="fio" src="n2o/controls/custom/value/value" css-class="n2o-label-8 n2o-control-8" />
                            <ctrl:custom label="Пол:" id="gender.name" src="n2o/controls/custom/value/value" css-class="n2o-label-3 n2o-control-3" />
                            <ctrl:custom label="Дата рождения:" id="birthday" src="n2o/controls/custom/value/value" css-class="n2o-label-4 n2o-control-4" />
                            <ctrl:custom label="ОМС:" id="oms" src="n2o/controls/custom/value/value" css-class="n2o-label-5 n2o-control-5" />
                            <ctrl:custom label="Кем выдан:" id="oms_issuer" src="n2o/controls/custom/value/value" css-class="n2o-label-9 n2o-control-9" />

                            <ctrl:custom label="Свидетельство о рождении:" id="birth_doc" src="n2o/controls/custom/value/value" css-class="n2o-label-4 n2o-control-4"/>
                            <ctrl:custom label="Паспорт:" id="passport" src="n2o/controls/custom/value/value" css-class="n2o-label-4 n2o-control-4"/>
                            <!--<ctrl:custom label="Социальный статус:" id="socialGroupName" src="n2o/controls/custom/value/value" css-class="n2o-label-5 n2o-control-5"/>-->
                        <!--</fs2:row>-->
                        <!--<fs2:row>-->
                        <!--</fs2:row>-->
                        <!--<fs2:row>-->
                            <ctrl:custom label="Адрес факт. проживания:" id="actualAddress" src="n2o/controls/custom/value/value" css-class="n2o-control-11 n2o-label-11" />
                        <!--</fs2:row>-->
                        <!--<fs2:row>-->
                            <ctrl:custom label="Адрес регистрации:" id="registerAddress" src="n2o/controls/custom/value/value" css-class="n2o-label-11 n2o-control-11"/>
                            <ctrl:custom label="Мед.Орг:" id="medOrg" src="n2o/controls/custom/value/value" css-class="n2o-label-9 n2o-control-9"/>
                            <ctrl:custom label="Номер участка:" id="district" src="n2o/controls/custom/value/value" css-class="n2o-label-4 n2o-control-4"/>
                            <ctrl:custom label="Амб.карта:" id="ambCard" src="n2o/controls/custom/value/value" css-class="n2o-label-4 n2o-control-4"/>

                            <ctrl:output-text id="forPatientCardLink" label="" label-style="width: 5px"
                                              control-style="width: 5px">
                                <ctrl:actions>
                                    <ctrl:link label="Перейти на КП">
                                        <ctrl:on-click src="n2o/widgets/custom/orphansGotoPatientCard.js"
                                                       function-name="gotoPatientCard"/>
                                    </ctrl:link>
                                    <ctrl:link label="Обновить">
                                        <ctrl:update-model query-id="orphansEventPatientDisprCard" master-field-id="id" detail-field-id="id"/>
                                    </ctrl:link>
                                </ctrl:actions>
                            </ctrl:output-text>
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="top" header="line">
                        <fs2:row>
                            <ctrl:select id="category_accounting_child" label="Категория учета ребенка" css-class="n2o-label-8 n2o-control-8" required="true">
                                <ctrl:query query-id="categoryAccountingChildList" label-field-id="name" value-field-id="id" />
                            </ctrl:select>
                            <ctrl:classifier id="education_org" label="Место учебы" css-class="n2o-label-8 n2o-control-8">
                                <ctrl:query query-id="dispEducationOrg" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:select id="location" label="На момент диспансеризации находится" css-class="n2o-label-8 n2o-control-8">
                                <ctrl:query query-id="statusChild" label-field-id="name" value-field-id="id" />
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="category_accounting_child">category_accounting_child.name == 'ребенок-сирота'</ctrl:required-condition>
                                </ctrl:dependencies>
                            </ctrl:select>
                            <ctrl:classifier id="stac_org" label="Место текущего нахождения" css-class="n2o-label-8 n2o-control-8">
                                <ctrl:query query-id="dispStacOrg" label-field-id="name" value-field-id="id"/>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="location">location.name == 'стационарном учреждении'</ctrl:required-condition>
                                </ctrl:dependencies>
                            </ctrl:classifier>
                            <ctrl:select id="reason" label="Причина выбытия из стационара" css-class="n2o-label-8 n2o-control-8">
                                <ctrl:query query-id="reasonDisposalOfHospital" label-field-id="name" value-field-id="id" />
                            </ctrl:select>
                        <!--</fs2:row>-->
                        <!--<fs2:row>-->
                            <ctrl:input-text id="miss_reason" label="Отсутствует по причине" css-class="n2o-label-7 n2o-control-7" />
                            <ctrl:date-time id="bdate" label="Дата поступления" format="DD.MM.YYYY" css-class="n2o-label-4 n2o-control-4">
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="location">location.name == 'стационарном учреждении'</ctrl:required-condition>
                                </ctrl:dependencies>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="correctData"/>
                                </ctrl:validations>
                            </ctrl:date-time>
                            <ctrl:date-time id="edate" label="Дата выбытия" format="DD.MM.YYYY" css-class="n2o-label-4 n2o-control-4" depends-on="bdate">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="correctDataEnd"/>
                                </ctrl:validations>
                                    </ctrl:date-time>
                        </fs2:row>
                    </fs2:field-set>
                    <wgt2:action-menu>
                        <wgt2:menu-item label="Редактировать" id="update">
                            <wgt2:go-edit action-id="update" />
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:form>
            </container>
        </region>
        <region place="leftresultbody" type="none">
            <container id="resultBeforeData" depends-on="patientData" opened="true">
                <wgt2:form master-field-id="id" detail-field-id="id">
                    <wgt2:id>modelResultCard</wgt2:id>
                    <wgt2:query-id>orphansResultBeforeDisprCard</wgt2:query-id>
                    <wgt2:name>До диспансеризации</wgt2:name>
                    <fs2:field-set>
                        <ctrl:classifier dependency-condition="event_type_code == 'ОН1' || event_type_code == 'ОН2' || event_type_code == 'ОН3' || event_type_code == 'ОН2.1' || event_type_code == 'ОН3.1' || event_type_code == 'ОН2.2' || event_type_code == 'ОН3.2' || event_type_code == 'ДС1' || event_type_code == 'ДС2'" id="health_group_physical_education" label="Группа здоровья для занятий физ.культурой" css-class="n2o-label-8 n2o-control-6">
                             <ctrl:query query-id="healthGroupPhysicalEducation" value-field-id="id" label-field-id="name"/>
                        </ctrl:classifier>
                        <ctrl:classifier label="Группа здоровья" id="health_group" css-class="n2o-label-6 n2o-control-8" required="true">
                            <ctrl:query query-id="dispHealthGroup" value-field-id="id" label-field-id="name">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="event_type_id" ref="event_type_id"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                            <ctrl:validations>
                                <ctrl:validation ref-id="countDiagnosisNotZBefore"/>
                            </ctrl:validations>
                        </ctrl:classifier>
                    </fs2:field-set>
                    <wgt2:action-menu>
                        <wgt2:menu-item label="Изменить" id="update">
                            <wgt2:edit refresh-after-submit="true">
                                <wgt2:invoke-action action-id="update" />
                            </wgt2:edit>
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:form>
                <pre-filters>
                    <pre-filter field-id="character" ref="character"/>
                </pre-filters>
            </container>
            <container id="dignosisDataBefore" depends-on="resultBeforeData" opened="true" refresh-dependent-container="true">
                <wgt:table master-field-id="result.id" detail-field-id="result.id" customize="jsp" src="n2o/widgets/custom/table-disp-refresh">
                    <wgt:id>dignosisDataBefore</wgt:id>
                    <wgt:query-id>orphansDisprCardDiagnosis</wgt:query-id>
                    <wgt:name>Диагнозы</wgt:name>
                    <wgt:columns>
                        <wgt:column column-field-id="diagnosis.name"/>
                        <wgt:column column-field-id="is_d">
                            <wgt:checkbox />
                        </wgt:column>
                    </wgt:columns>
                    <wgt:action-menu>
                        <wgt:menu-item id="add" label="Добавить" icon="icon-plus" type="icon" context="false">
                            <wgt:show-modal width="660px" page-id="orphansDisprCardBeforeDiagnosis" container-id="main" action-id="add" master-field-id="result.id"
                                            detail-field-id="result.id">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="character" ref="character"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="update" label="Изменить" icon="icon-pencil" type="icon" context="true">
                            <wgt:show-modal width="660px" page-id="orphansDisprCardBeforeDiagnosis" container-id="main" action-id="update">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="id" ref="id"/>
                                    <wgt:pre-filter field-id="result.id" ref="result.id"/>
                                    <wgt:pre-filter field-id="character" ref="character"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="delete" label="Удалить" icon="icon-remove" type="icon" context="true">
                            <wgt:invoke-action action-id="delete" confirmation="true">
                            </wgt:invoke-action>
                        </wgt:menu-item>
                        <wgt:menu-item id="add_diagnosis" label="Загрузить" context="false" icon="icon-download-alt" type="textAndIcon">
                            <wgt:show-modal page-id="orphansDisprCardDiagnosisLoad" master-field-id="result.id"
                                            detail-field-id="result.id"/>
                        </wgt:menu-item>
                    </wgt:action-menu>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="is_before" value="true"/>
                    <pre-filter field-id="character" ref="character"/>
                </pre-filters>
            </container>
        </region>
        <region place="rightresultbody" type="none">
            <container id="resultData" depends-on="patientData" opened="true">
                <wgt2:form master-field-id="id" detail-field-id="id">
                    <wgt2:id>modelResultCard</wgt2:id>
                    <wgt2:query-id>orphansResultDisprCard</wgt2:query-id>
                    <wgt2:name>После диспансеризации</wgt2:name>
                    <fs2:field-set field-label-location="left">
                        <fs2:row>
                            <ctrl:date-time id="open_date" label="Дата открытия" css-class="n2o-label-4 n2o-control-4" required="true"/>
                            <ctrl:date-time id="close_date" label="Дата закрытия" css-class="n2o-label-4 n2o-control-4" readonly="true">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="checkDispLength"/>
                                    <ctrl:validation ref-id="checkMaxDate"/>
                                    <ctrl:validation ref-id="checkCloseCase"/>
                                </ctrl:validations>
                                <ctrl:actions>
                                    <ctrl:link label="Обновить">
                                        <ctrl:update-model query-id="orphansResultDisprCard" master-field-id="id" detail-field-id="id" />
                                    </ctrl:link>
                                </ctrl:actions>
                            </ctrl:date-time>
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="left">
                        <fs2:row>
                            <ctrl:classifier dependency-condition="event_type_code == 'ОН1' || event_type_code == 'ОН2' || event_type_code == 'ОН3' || event_type_code == 'ОН2.1' || event_type_code == 'ОН3.1' || event_type_code == 'ОН2.2' || event_type_code == 'ОН3.2' || event_type_code == 'ДС1' || event_type_code == 'ДС2'" id="health_group_physical_education" label="Группа здоровья для занятий физ.культурой" css-class="n2o-label-8 n2o-control-6">
                                <ctrl:query query-id="healthGroupPhysicalEducation" value-field-id="id" label-field-id="name"/>
                            </ctrl:classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:classifier label="Группа здоровья" id="health_group" css-class="n2o-label-6 n2o-control-8" required="true">
                                <ctrl:query query-id="dispHealthGroup" value-field-id="id" label-field-id="name">
                                    <ctrl:pre-filters>
                                        <ctrl:pre-filter field-id="event_type_id" ref="event_type_id"/>
                                    </ctrl:pre-filters>
                                </ctrl:query>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="countDiagnosisNotZBefore"/>
                                </ctrl:validations>
                            </ctrl:classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:text-area rows="6" id="recommendation" label="Рекомендации по здоровому образу жизни" css-class="n2o-label-6 n2o-control-8" />
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="left" header="line" label="Прививки">
                        <!--<fs2:row>-->
                            <!--<ctrl:checkbox id="already_vac" label="Привит по возрасту" />-->
                        <!--</fs2:row>-->
                        <fs2:row>
                            <ctrl:radio-group id="vac_mode" label-style="display: none;" css-class="n2o-control-8">
                                <ctrl:query query-id="reasonVaccine" detail-field-id="id" label-field-id="name" />
                            </ctrl:radio-group>
                            <ctrl:classifier id="vac_mode_value" label="Как?" depends-on="vac_mode" dependency-condition="vac_mode.id != 1" label-style="width: auto; margin-left: -29px;" css-class="n2o-control-4" control-style="margin-left: 15px;">
                                <ctrl:query query-id="volumeMadeVaccine" detail-field-id="id" label-field-id="name" />
                            </ctrl:classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:multi-classifier id="need_new_vac" label="Нуждается в проведении вакцинации" css-class="n2o-control-8 n2o-label-6">
                                <ctrl:query query-id="vaccine_type" detail-field-id="id" label-field-id="label" />
                            </ctrl:multi-classifier>
                        </fs2:row>
                    </fs2:field-set>
                    <wgt2:action-menu>
                        <wgt2:menu-item label="Изменить" id="update">
                            <wgt2:edit refresh-after-submit="true">
                                <wgt2:invoke-action action-id="update" />
                            </wgt2:edit>
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:form>
                <pre-filters>
                    <pre-filter field-id="character" ref="character"/>
                </pre-filters>
            </container>
            <container id="dignosisData" depends-on="resultData" opened="true" refresh-dependent-container="true">
                <wgt:table master-field-id="result.id" detail-field-id="result.id" customize="jsp" src="n2o/widgets/custom/table-disp-refresh">
                    <wgt:id>dignosisData</wgt:id>
                    <wgt:query-id>orphansDisprCardDiagnosis</wgt:query-id>
                    <wgt:name>Диагнозы</wgt:name>
                    <wgt:columns>
                        <wgt:column column-field-id="diagnosis.name"/>
                        <wgt:column column-field-id="make_d">
                            <wgt:checkbox />
                        </wgt:column>
                    </wgt:columns>
                    <wgt:action-menu>
                        <wgt:menu-item id="add" label="Добавить" icon="icon-plus" type="icon" context="false">
                            <wgt:show-modal width="660px" page-id="orphansDisprCardDiagnosis" container-id="main" action-id="add" master-field-id="result.id"
                                            detail-field-id="result.id">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="character" ref="character"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="update" label="Изменить" icon="icon-pencil" type="icon" context="true">
                            <wgt:show-modal width="660px" page-id="orphansDisprCardDiagnosis" container-id="main" action-id="update">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="id" ref="id"/>
                                    <wgt:pre-filter field-id="character" ref="character"/>
                                </wgt:pre-filters>
                            </wgt:show-modal>
                        </wgt:menu-item>
                        <wgt:menu-item id="delete" label="Удалить" icon="icon-remove" type="icon" context="true">
                            <wgt:invoke-action action-id="delete" confirmation="true">
                            </wgt:invoke-action>
                        </wgt:menu-item>
                    </wgt:action-menu>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="indiv.case.id" ref="caseId"/>
                    <pre-filter field-id="character" ref="character"/>
                </pre-filters>
            </container>
        </region>
        <!--<region place="rightresultbefore" type="none">

        </region>
        <region place="rightresult" type="none">

        </region>-->
        <region place="bottom" type="tabs">
            <container id="serviceData" depends-on="patientData" opened="true">
                <wgt2:table master-field-id="id" detail-field-id="mainId">
                    <wgt2:id>serviceData</wgt2:id>
                    <wgt2:query-id>disprCardService</wgt2:query-id>
                    <wgt2:name>Осмотры и услуги</wgt2:name>
                    <wgt2:sortings>
                        <wgt2:sorting sorting-field-id="status.id" direction="ASC"/>
                        <wgt2:sorting sorting-field-id="date_render" direction="ASC"/>
                        <wgt2:sorting sorting-field-id="first" direction="DESC"/>
                        <wgt2:sorting sorting-field-id="order" direction="ASC"/>
                        <wgt2:sorting sorting-field-id="last" direction="ASC"/>
                        <wgt2:sorting sorting-field-id="id" direction="ASC"/>
                    </wgt2:sortings>
                    <wgt2:rows>
                        <wgt2:color>
                            <wgt2:switch value-field-id="status.id">
                                <wgt2:case value="2">error</wgt2:case>
                                <wgt2:case value="3">warning</wgt2:case>
                                <wgt2:case value="4">success</wgt2:case>
                            </wgt2:switch>
                        </wgt2:color>
                    </wgt2:rows>
                    <wgt2:columns>
                        <wgt2:column column-field-id="service.name"/>
                        <wgt2:column column-field-id="org.short_name"/>
                        <wgt2:column column-field-id="resource.name"/>
                        <wgt2:column column-field-id="status.name"/>
                        <wgt2:column column-field-id="date_render"/>
                        <!--<wgt:column column-field-id="date_before"/>-->
                        <wgt2:column column-field-id="date_deni"/>
                    </wgt2:columns>
                    <wgt2:action-menu>
                        <!--<wgt:menu-item id="insertData" label="Услуга" icon="icon-pencil" type="text" context="true" color="btn-success">
                            <wgt:open-page page-id="disprCardRenderingService" result-container-id="main" refresh-on-close="true">
                                <wgt:pre-filters>
                                    <wgt:pre-filter field-id="id" ref="id" />
                                    <wgt:pre-filter field-id="event_patient_id" ref="mainId"/>
                                </wgt:pre-filters>
                            </wgt:open-page>
                            <wgt:conditions>
                                <wgt:enabling-condition>
                                    <wgt:expression>agreeService == true</wgt:expression>
                                    <wgt:tooltip>Пациент отказался от услуги</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[(service_code != 'Д1.02') && (service_code != 'Д1.04')]]></wgt:expression>
                                    <wgt:tooltip>Пациент ранее проходил эту услугу</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_has_first == true) && ((v_is_first == true) || (v_first_ren == true))) || (v_has_first != true)]]></wgt:expression>
                                    <wgt:tooltip>Пациенту не оказали первую услугу</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_is_last == true) && (v_last_all_ren == true)) || (v_has_last != true) || (v_is_last != true)]]></wgt:expression>
                                    <wgt:tooltip>Перед оказание последней услуги, нужно оказать все другие.</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>-->
                        <wgt2:menu-item id="inspec" label="Осмотр" icon="icon-pencil" type="text" context="true" color="btn-success">
                            <wgt2:open-page page-id="dispServiceOrphans${formId}" page-name="{serviceData.service.name}" width="530px" result-container-id="main" refresh-on-close="true">
                                <wgt2:pre-filters>
                                    <wgt2:pre-filter field-id="event_patient_id" ref="mainId"/>
                                    <wgt2:pre-filter field-id="id" ref="id" />
                                    <!--<wgt:pre-filter field-id="service_patient_id" ref="id" />-->
                                </wgt2:pre-filters>
                            </wgt2:open-page>
                            <wgt2:conditions>
                                <!--<wgt:visibility-condition>
                                    <wgt:expression><![CDATA[(service_code == 'ДС1.2') || (service_code == 'ДС1.3') || (service_code == 'ДС1.4') || (service_code == 'ДС1.5') || (service_code == 'ДС1.6') || (service_code == 'ДС1.7') || (service_code == 'ДС1.8') || (service_code == 'ДС1.9') || (service_code == 'ДС1.10') || (service_code == 'ДС1.11') || (service_code == 'ДС1.12') || (service_code == 'ОН1.2') || (service_code == 'ОН1.3') || (service_code == 'ОН1.4') || (service_code == 'ОН1.5') || (service_code == 'ОН1.6') || (service_code == 'ОН1.7') || (service_code == 'ОН1.8') || (service_code == 'ОН1.9') || (service_code == 'ОН1.10') || (service_code == 'ОН1.11') || (service_code == 'ОН1.12')  || (service_code == 'ОН1.14')]]></wgt:expression>
                                </wgt:visibility-condition>-->
                                <wgt2:enabling-condition>
                                    <wgt2:expression>agreeService == true</wgt2:expression>
                                    <wgt2:tooltip>Пациент отказался от услуги</wgt2:tooltip>
                                </wgt2:enabling-condition>
                                <wgt2:enabling-condition>
                                    <wgt2:expression><![CDATA[((v_has_first == true) && ((v_is_first == true) || (v_first_ren == true))) || (v_has_first != true)]]></wgt2:expression>
                                    <wgt2:tooltip>Пациенту не оказали первую услугу</wgt2:tooltip>
                                </wgt2:enabling-condition>
                                <wgt2:enabling-condition>
                                    <wgt2:expression><![CDATA[((v_is_last == true) && (v_last_all_ren == true)) || (v_has_last != true) || (v_is_last != true)]]></wgt2:expression>
                                    <wgt2:tooltip>Перед оказание последней услуги, нужно оказать все другие.</wgt2:tooltip>
                                </wgt2:enabling-condition>
                                <wgt2:enabling-condition>
                                    <wgt2:expression>status.id != 3</wgt2:expression>
                                    <wgt2:tooltip>Услуга оказана ранее</wgt2:tooltip>
                                </wgt2:enabling-condition>
                            </wgt2:conditions>
                        </wgt2:menu-item>
                        <!--<wgt:menu-item id="service" label="Услуга" icon="icon-pencil" type="text" context="true" color="btn-success">
                            <wgt:show-modal page-id="orphansDisprCardService" action-id="update" width="500px" master-field-id="mainId" detail-field-id="id" result-container-id="main" refresh-on-close="true">
                                <wgt:pre-filters>
                                    &lt;!&ndash;<wgt:pre-filter field-id="id" ref="mainId" />&ndash;&gt;
                                    <wgt:pre-filter field-id="service_code" ref="service_code" />
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression><![CDATA[(service_code == 'ДС1.13') || (service_code == 'ДС1.14') || (service_code == 'ДС1.15') || (service_code == 'ДС1.16') || (service_code == 'ДС1.17') || (service_code == 'ДС1.18') || (service_code == 'ДС1.19') || (service_code == 'ДС1.20') || (service_code == 'ДС1.21') || (service_code == 'ДС1.22') || (service_code == 'ДС1.23') || (service_code == 'ОН1.13') || (service_code == 'ОН1.14') || (service_code == 'ОН1.15') || (service_code == 'ОН1.16') || (service_code == 'ОН1.17') || (service_code == 'ОН1.18') || (service_code == 'ОН1.19') || (service_code == 'ОН1.20') || (service_code == 'ОН1.21') || (service_code == 'ОН1.22') || (service_code == 'ОН1.23') || (service_code == 'ОН1.24') || (service_code == 'ОН1.25') || (service_code == 'ОН1.26') || (service_code == 'ОН1.27') || (service_code == 'ОН1.28') || (service_code == 'ОН1.29')]]></wgt:expression>
                                </wgt:visibility-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression>agreeService == true</wgt:expression>
                                    <wgt:tooltip>Пациент отказался от услуги</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_has_first == true) && ((v_is_first == true) || (v_first_ren == true))) || (v_has_first != true)]]></wgt:expression>
                                    <wgt:tooltip>Пациенту не оказали первую услугу</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_is_last == true) && (v_last_all_ren == true)) || (v_has_last != true) || (v_is_last != true)]]></wgt:expression>
                                    <wgt:tooltip>Перед оказание последней услуги, нужно оказать все другие.</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression>status.id != 3</wgt:expression>
                                    <wgt:tooltip>Услуга оказана ранее</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>-->
                       <!-- <wgt:menu-item id="service_pediatr" label="Осмотр" icon="icon-pencil" type="text" context="true" color="btn-success">
                            <wgt:show-modal page-id="orphansDisprCardInspecPediatr" action-id="update" width="530px" master-field-id="mainId" detail-field-id="id" result-container-id="main" refresh-on-close="true">
                                <wgt:pre-filters>
                                    &lt;!&ndash;<wgt:pre-filter field-id="id" ref="mainId" />&ndash;&gt;
                                    <wgt:pre-filter field-id="service_code" ref="service_code" />
                                </wgt:pre-filters>
                            </wgt:show-modal>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression><![CDATA[(service_code == 'ДС1.1') || (service_code == 'ОН1.1')]]></wgt:expression>
                                </wgt:visibility-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression>agreeService == true</wgt:expression>
                                    <wgt:tooltip>Пациент отказался от услуги</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_has_first == true) && ((v_is_first == true) || (v_first_ren == true))) || (v_has_first != true)]]></wgt:expression>
                                    <wgt:tooltip>Пациенту не оказали первую услугу</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression><![CDATA[((v_is_last == true) && (v_last_all_ren == true)) || (v_has_last != true) || (v_is_last != true)]]></wgt:expression>
                                    <wgt:tooltip>Перед оказание последней услуги, нужно оказать все другие.</wgt:tooltip>
                                </wgt:enabling-condition>
                                <wgt:enabling-condition>
                                    <wgt:expression>status.id != 3</wgt:expression>
                                    <wgt:tooltip>Услуга оказана ранее</wgt:tooltip>
                                </wgt:enabling-condition>
                            </wgt:conditions>
                        </wgt:menu-item>-->
                        <wgt2:menu-item id="searchService" label="Найти" icon="icon-search" type="textAndIcon" context="true" color="btn-primary">
                            <wgt2:show-modal page-id="searchService" container-id="main" action-id="search" model="query" master-field-id="mainId" detail-field-id="id">
                                <wgt2:pre-filters>
                                    <!--<wgt:pre-filter field-id="id" ref="mainId"/>-->
                                    <wgt2:pre-filter field-id="service_patient_id" ref="id" />
                                </wgt2:pre-filters>
                            </wgt2:show-modal>
                            <wgt2:conditions>
                                <wgt2:enabling-condition>
                                    <wgt2:expression>status.id == 3 || status.id == 1</wgt2:expression>
                                    <wgt2:tooltip>Услугу оказали в рамках мероприятия</wgt2:tooltip>
                                </wgt2:enabling-condition>
                            </wgt2:conditions>
                        </wgt2:menu-item>
                        <wgt2:menu-item id="clearService" label="Очистить" icon="icon-ban-circle" type="textAndIcon" context="true" color="btn-warning">
                            <wgt2:invoke-action action-id="clearService" confirmation="true" />
                            <wgt2:conditions>
                                <wgt2:enabling-condition>
                                    <wgt2:expression>status.id == 3 || status.id == 4</wgt2:expression>
                                    <wgt2:tooltip>Услугу еще не оказали</wgt2:tooltip>
                                </wgt2:enabling-condition>
                            </wgt2:conditions>
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:table>
            </container>
            <container id="disprCardMaturity" depends-on="patientData">
                <wgt2:form master-field-id="id" detail-field-id="id">
                    <wgt2:id>disprCardMaturity</wgt2:id>
                    <wgt2:query-id>orphansDisprCardMaturity</wgt2:query-id>
                    <wgt2:name>Развитие</wgt2:name>
                    <fs2:field-set field-label-location="left">
                        <fs2:row>
                            <ctrl:output-text id="full_age" label="Возраст на момент диспансеризации" css-class="n2o-control-12 n2o-label-9" control-style="font-weight: bold;font-size: 16px;text-decoration: underline;" label-style="text-align: center; font-weight: bold;font-size: 16px;"/>
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="left" header="line">
                        <fs2:row>
                            <ctrl:input-text id="weight" label="Вес,кг" css-class="n2o-control-3 n2o-label-3" required="true">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="weightIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                            <ctrl:input-text id="height" label="Рост,см" css-class="n2o-control-3 n2o-label-3" required="true">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="heightIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                            <ctrl:input-text id="head_circumference" label="Окр.головы,см" css-class="n2o-control-3 n2o-label-4" dependency-condition="age.year &lt;= 4" required="true">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="head_circumferenceIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                        </fs2:row>
                        <!--<fs2:row>-->
                            <!--<ctrl:input-text id="index_mass" label="Масса" css-class="n2o-control-3 n2o-label-3" readonly="true">-->
                                <!--<ctrl:set-value-expression on="weight,height">((weight)/((height/100) * (height/100))).toFixed(2)</ctrl:set-value-expression>-->
                            <!--</ctrl:input-text>-->
                            <!--<ctrl:input-text id="index_height" label="" css-class="n2o-control-3 n2o-label-3" />-->
                        <!--</fs2:row>-->
                        <fs2:row>
                            <ctrl:radio-group id="value_mass" label="Масса тела" css-class="n2o-control-3 n2o-label-3">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Норма"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Дефицит"}</ctrl:option>
                                    <ctrl:option>{"id": 3, "name": "Избыток"}</ctrl:option>
                                </ctrl:options>
                            </ctrl:radio-group>
                            <ctrl:radio-group id="value_height" label="Рост" css-class="n2o-control-3 n2o-label-3">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Норма"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Низкий"}</ctrl:option>
                                    <ctrl:option>{"id": 3, "name": "Высокий"}</ctrl:option>
                                </ctrl:options>
                            </ctrl:radio-group>
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="left" header="line" label="Психическое развитие">
                        <fs2:row>
                            <ctrl:input-text id="cognitive_function" label="Познавательная функция,мес" dependency-condition="age.year &lt;= 4" required="true">
                                <ctrl:set-value-expression on="age_in_month">age_in_month</ctrl:set-value-expression>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="cognitive_functionIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                            <ctrl:select id="psychomotor_sphere" label="Психомоторная сфера" dependency-condition="age.year &gt;= 5 &amp;&amp; age.year &lt;= 17">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Норма"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Нарушение"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:default-model>
                                    <ctrl:value field-id="id">1</ctrl:value>
                                    <ctrl:value field-id="name">Норма</ctrl:value>
                                </ctrl:default-model>
                            </ctrl:select>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:input-text id="motor_function" label="Моторная функция,мес" dependency-condition="age.year &lt;= 4" required="true">
                                <ctrl:set-value-expression on="age_in_month">age_in_month</ctrl:set-value-expression>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="motor_functionIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                            <ctrl:select id="intelligence" label="Интеллект" dependency-condition="age.year &gt;= 5 &amp;&amp; age.year &lt;= 17">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Норма"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Нарушение"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:default-model>
                                    <ctrl:value field-id="id">1</ctrl:value>
                                    <ctrl:value field-id="name">Норма</ctrl:value>
                                </ctrl:default-model>
                            </ctrl:select>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:input-text id="emotional_social_function" label="Эмоциональная и социальная (контакт с окружающим миром) функции,мес" dependency-condition="age.year &lt;= 4" required="true">
                                <ctrl:set-value-expression on="age_in_month">age_in_month</ctrl:set-value-expression>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="emotional_social_functionIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                            <ctrl:select id="emotional_vegetative_sphere" label="Эмоционально-вегетативная сфера" dependency-condition="age.year &gt;= 5 &amp;&amp; age.year &lt;= 17">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Норма"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Нарушение"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:default-model>
                                    <ctrl:value field-id="id">1</ctrl:value>
                                    <ctrl:value field-id="name">Норма</ctrl:value>
                                </ctrl:default-model>
                            </ctrl:select>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:input-text id="language_function" label="Предречевое и речевое развитие,мес" dependency-condition="age.year &lt;= 4" required="true">
                                <ctrl:set-value-expression on="age_in_month">age_in_month</ctrl:set-value-expression>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="language_functionIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                        </fs2:row>
                    </fs2:field-set>
                    <fs2:field-set field-label-location="left" header="line" label="Оценка полового созревания" dependency-condition="age.year &gt;= 10">
                        <fs2:row>
                            <ctrl:select id="male_p" label="P" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 1" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                            <ctrl:select id="female_p" label="P" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                            <ctrl:input-text id="menarhe" label="menarhe,лет" css-class="n2o-control-4 n2o-label-4" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="menarheIsNumberCondition"/>
                                </ctrl:validations>
                            </ctrl:input-text>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:select id="male_ax" label="Ax" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 1" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                            <ctrl:select id="female_ax" label="Ax" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>

                            <ctrl:radio-group id="menses_rate" label="menses" css-class="n2o-control-3 n2o-label-3"
                                              dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2 &amp;&amp; (menarhe != null) &amp;&amp; (menarhe != '')">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Регулярные"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Нерегулярные"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="menarhe">(menarhe != null) &amp;&amp; (menarhe != '')</ctrl:required-condition>
                                </ctrl:dependencies>
                                <ctrl:set-value-expression on="menarhe">
                                    <![CDATA[
                                        if ((menarhe == null) || (menarhe == '')) null;
                                        else throw '!';
                                    ]]>
                                </ctrl:set-value-expression>
                            </ctrl:radio-group>
                            <ctrl:radio-group id="menses_quantity" label="menses" css-class="n2o-control-3 n2o-label-3" control-style="margin-left: 30px;" label-style="display: none;"
                                              dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2 &amp;&amp; (menarhe != null) &amp;&amp; (menarhe != '')">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Обильные"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Умеренные"}</ctrl:option>
                                    <ctrl:option>{"id": 3, "name": "Скудные"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="menarhe">(menarhe != null) &amp;&amp; (menarhe != '')</ctrl:required-condition>
                                </ctrl:dependencies>
                                <ctrl:set-value-expression on="menarhe">
                                    <![CDATA[
                                        if ((menarhe == null) || (menarhe == '')) null;
                                        else throw '!';
                                    ]]>
                                </ctrl:set-value-expression>
                            </ctrl:radio-group>
                            <ctrl:radio-group id="menses_pain" label="menses" css-class="n2o-control-3 n2o-label-3" label-style="display: none;"
                                              dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2 &amp;&amp; (menarhe != null) &amp;&amp; (menarhe != '')">
                                <ctrl:options>
                                    <ctrl:option>{"id": 1, "name": "Болезненные"}</ctrl:option>
                                    <ctrl:option>{"id": 2, "name": "Безболезненные"}</ctrl:option>
                                </ctrl:options>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="menarhe">(menarhe != null) &amp;&amp; (menarhe != '')</ctrl:required-condition>
                                </ctrl:dependencies>
                                <ctrl:set-value-expression on="menarhe">
                                    <![CDATA[
                                        if ((menarhe == null) || (menarhe == '')) null;
                                        else throw '!';
                                    ]]>
                                </ctrl:set-value-expression>
                            </ctrl:radio-group>

                        </fs2:row>
                        <fs2:row>
                            <ctrl:select id="male_fa" label="Fa" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 1" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                            <ctrl:select id="female_ma" label="Ma" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:select id="female_me" label="Me" css-class="n2o-control-4 n2o-label-1" dependency-condition="age.year &gt;= 10 &amp;&amp; gender.id == 2" required="true">
                                <ctrl:query query-id="dispSexualCharacters" label-field-id="name" value-field-id="id"/>
                            </ctrl:select>
                        </fs2:row>
                    </fs2:field-set>
                    <wgt2:action-menu>
                        <wgt2:menu-item label="Изменить" id="update">
                            <wgt2:go-edit action-id="update" />
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:form>
            </container>
            <container id="disprCardDisability" depends-on="patientData">
                <wgt2:form master-field-id="id" detail-field-id="id">
                    <wgt2:id>disprCardDisability</wgt2:id>
                    <wgt2:query-id>orphansDisprCardDisability</wgt2:query-id>
                    <wgt2:name>Инвалидность</wgt2:name>
                    <fs2:field-set field-label-location="left">
                        <fs2:row>
                            <ctrl:classifier id="disability_type" label="Ивалидность">
                                <ctrl:query query-id="disabilityType" value-field-id="id" label-field-id="name"/>
                            </ctrl:classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:date-time id="date_disability" label="Установлена впервые" css-class="n2o-control-4">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="dates"/>
                                </ctrl:validations>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="disability_type">
                                        (typeof disability_type != 'undefined') &amp;&amp; (disability_type != null) &amp;&amp; (disability_type.id != null)
                                    </ctrl:required-condition>
                                </ctrl:dependencies>
                            </ctrl:date-time>
                            <ctrl:date-time id="date_last_survey" label="Дата последнего освидетельствования" css-class="n2o-control-4">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="dates"/>
                                </ctrl:validations>
                            </ctrl:date-time>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:multi-classifier id="diagnosis_disability" label="Заболевание, обусловившее инвалидность">
                                <ctrl:query query-id="disprCardDiagnosisD" value-field-id="id" label-field-id="name"/>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="disability_type">
                                        (typeof disability_type != 'undefined') &amp;&amp; (disability_type != null) &amp;&amp; (disability_type.id != null)
                                    </ctrl:required-condition>
                                </ctrl:dependencies>
                            </ctrl:multi-classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:multi-classifier id="violations_in_health" label="Виды нарушений в состоянии здоровья">
                                <ctrl:query query-id="violationsInHealth" value-field-id="id" label-field-id="name"/>
                                <ctrl:dependencies>
                                    <ctrl:required-condition on="disability_type">
                                        (typeof disability_type != 'undefined') &amp;&amp; (disability_type != null) &amp;&amp; (disability_type.id != null)
                                    </ctrl:required-condition>
                                </ctrl:dependencies>
                            </ctrl:multi-classifier>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:date-time id="date_ipr" label="Дата назначения ИПР" css-class="n2o-control-4"/>
                        </fs2:row>
                        <fs2:row>
                            <ctrl:classifier id="ipr_made" label="ИПР выполнена на момент диспансеризации">
                                <ctrl:query query-id="volumeMadeIpr" value-field-id="id" label-field-id="name"/>
                            </ctrl:classifier>
                        </fs2:row>
                    </fs2:field-set>
                    <wgt2:action-menu>
                        <wgt2:menu-item label="Изменить" id="update">
                            <wgt2:go-edit action-id="update" />
                        </wgt2:menu-item>
                    </wgt2:action-menu>
                </wgt2:form>
            </container>
            <container id="disprCardAdvancedService" depends-on="patientData">
                <wgt:table ref-id="dispReferralList2stage" master-field-id="caseId" detail-field-id="case_id"/>
            </container>
        </region>
    </regions>
</page>