<?xml version='1.0' encoding='UTF-8'?>
<page xmlns="http://n2oapp.net/framework/config/schema/page-1.0"
      xmlns:wgt="http://n2oapp.net/framework/config/schema/n2o-widget-2.0"
      xmlns:ctrl="http://n2oapp.net/framework/config/schema/n2o-control-1.0"
      xmlns:info="http://n2oapp.net/framework/config/schema/info-panel-widget-1.0"
      xmlns:fs="http://n2oapp.net/framework/config/schema/fieldset-2.0">

    <object-id>resultAdmission</object-id>
    <layout>clinic/n2o/layout/resultsAdmissionLayout</layout>
    <name>Результаты приема</name>
    <regions>
        <region place="top" type="none">
            <container id="cardPlace">
                <wgt:edit-form master-field-id="id" detail-field-id="id" css-class="cardPlace">
                    <wgt:query-id>personalDataOfThePatient</wgt:query-id>
                    <wgt:model>query</wgt:model>
                    <fs:field-set>
                        <fs:row>
                            <ctrl:classifier id="place" search-are-you-type="true" label="Местонахождение АМК" css-class="place" readonly="true">
                                <ctrl:query query-id="clinicCardPlace" label-field-id="name" value-field-id="id"/>
                                <ctrl:validations>
                                    <ctrl:validation ref-id="isCardPlaceCheckError" side="server"/>
                                </ctrl:validations>
                            </ctrl:classifier>       
                        </fs:row>
                    </fs:field-set>
                </wgt:edit-form>
            </container>
            <container id="personalDataOfThePatient">
                <info:form master-field-id="id" detail-field-id="id" css-class="infoPanel">
                    <info:name> </info:name>
                    <info:query-id>personalDataOfThePatient</info:query-id>
                    <!--<info:action-menu>
                        <wgt:menu-item id="cardPlace" label="АМК">
                            <wgt:show-modal page-id="patientCardPlace" master-field-id="patient.id" detail-field-id="patientId"/>
                        </wgt:menu-item>
                        <wgt:menu-item id="toEMK" label="ЭМК" icon="icomoon-book">
                            <wgt:a href="/cases/tree?value=:patient.id:" target="newWindow"/>
                        </wgt:menu-item>

                        <wgt:menu-item id="toPatient" label="Пациент" icon="icomoon-user">
                            <wgt:a href="/pats/patients/:patient.id:/view" target="newWindow"/>
                        </wgt:menu-item>
                        <info:menu-item id="planing" label="Запись на повторный прием">
                            <info:a href="${rmis.external.host}/plan/planning?organizationId=:patient.orgId:&amp;value=:patient.id:&amp;service.id=:serviceId:&amp;:resourceGroupId:" target="newWindow"/>
                        </info:menu-item>
                    </info:action-menu>-->
                    <info:info-panel id="patient" show-personal-data="true" show-medical-data="true" readonly="true">
                    </info:info-panel>
                    <!--   <fs:field-set>
                                 <fs:row>
                                     <ctrl:output-text id="patient.name" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;" css-class="little-style"/>
                                     <ctrl:output-text id="patient.gender" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;width:120px;" css-class="little-style"/>
                                     <ctrl:output-text id="patientJob" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;" css-class="littleInfo-style"/>
                                     <ctrl:output-text id="patientAddress" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;" css-class="littleInfo-style"/>
                                 </fs:row>
                             </fs:field-set>

                             <fs:field-set>
                                 <fs:row>
                                     <ctrl:output-text id="patient.bt" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;width:120px;" css-class="little-style"/>
                                     <ctrl:output-text id="patientReg.numberAttach" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;width:120px;" css-class="little-style"/>
                                     <ctrl:output-text id="patientContact" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;" css-class="littleInfo-style"/>
                                     &lt;!&ndash;<ctrl:output-text id="patientAddress"  label-style="text-align: left; width: auto;" control-style="font-weight: bold;" css-class="littleInfo-style"/>&ndash;&gt;
                                 </fs:row>
                             </fs:field-set>
                             <fs:field-set header="line">
                                 <fs:row>
                                     <ctrl:output-text id="drugIntolerance" label-style="text-align: left; width: auto;"
                                                       control-style="font-weight: bold;color: #d14836; width:400px;"
                                                       css-class="big-style" dependency-condition="drugIntolerance != null">
                                         <ctrl:actions>
                                             <ctrl:link label="Еще">
                                                 <ctrl:show-modal page-id="drugIntolerance" detail-field-id="patient.id"
                                                                  master-field-id="patient.id"/>
                                                 <ctrl:dependencies>
                                                     <ctrl:visibility-condition on="countDrugIntolerance">(countDrugIntolerance
                                                         == 'true')
                                                     </ctrl:visibility-condition>
                                                 </ctrl:dependencies>
                                             </ctrl:link>
                                         </ctrl:actions>
                                     </ctrl:output-text>
                                 </fs:row>
                             </fs:field-set>-->
                </info:form>
            </container>
        </region>
      <!--   <region place="top-2" type="list">
                  <container id="drugIntolerance" depends-on="personalDataOfThePatient" opened="false">
                      <wgt:table detail-field-id="patient.id" master-field-id="patient.id">
                          <wgt:name>Лекарственная непереносимость</wgt:name>
                          <wgt:query-id>drugIntolerance</wgt:query-id>
                          <wgt:size>10</wgt:size>
                          <wgt:action-menu>
                              <wgt:menu-item id="addDrugIntolerance" label="Добавить" context="false" icon="icomoon-plus"
                                             color="btn btn-primary">
                                  <wgt:show-modal page-id="addDrugIntoleranceInPatient" action-id="create"
                                                  refresh-on-close="true" master-field-id="patient.id"
                                                  detail-field-id="patient.id"/>
                              </wgt:menu-item>
                              <wgt:menu-item label="Удалить" id="delete" context="true" color="btn btn-inverse"
                                             icon="icomoon-bin">
                                  <wgt:invoke-action action-id="delete" confirmation="true"/>
                              </wgt:menu-item>
                          </wgt:action-menu>
                          <wgt:columns>
                              <wgt:column column-field-id="drug.name"/>
                              <wgt:column column-field-id="note"/>
                          </wgt:columns>
                      </wgt:table>
                  </container>
              </region>-->
<!--        <region place="center">
            <container id="isNew" depends-on="personalDataOfThePatient"
                       dependency-condition="personalDataOfThePatient.dtStep == null">
                <wgt:edit-form detail-field-id="appointmentId" master-field-id="id">
                    <wgt:name>Посещение</wgt:name>
                    <wgt:query-id>resultAdmissionCase</wgt:query-id>
                    <wgt:model>query</wgt:model>
                    <fs:field-set>
                        <ctrl:output-text id="1" label=""/>
                    </fs:field-set>
                    <wgt:action-menu>
                        <wgt:menu-item id="createVisitAndCase" label="Создать новое посещение" icon="icomoon-plus"
                                       color="btn btn-primary">
                            <wgt:show-modal page-id="createVisitAndCase" action-id="createVisit"
                                            refresh-on-close="true" master-field-id="id"
                                            detail-field-id="appointmentId" model="query"/>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression>
                                        appointmentIsHouseCall == false &amp;&amp; dtStep == null
                                    </wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                        <wgt:menu-item id="createHomeVisitAndCase" label="Создать новое посещение" icon="icomoon-plus"
                                       color="btn btn-primary">
                            <wgt:show-modal page-id="createHomeVisitAndCase" action-id="createVisit"
                                            refresh-on-close="true" master-field-id="id"
                                            detail-field-id="appointmentId" model="query"/>
                            <wgt:conditions>
                                <wgt:visibility-condition>
                                    <wgt:expression>appointmentIsHouseCall == true &amp;&amp; dtStep == null
                                    </wgt:expression>
                                </wgt:visibility-condition>
                            </wgt:conditions>
                        </wgt:menu-item>
                    </wgt:action-menu>
                </wgt:edit-form>
            </container>
        </region>-->
        <region place="center" type="none" >
            <container id="admissionCase" depends-on="personalDataOfThePatient" opened="false" refresh-dependent-container="true">
                <wgt:edit-form detail-field-id="id" master-field-id="id" css-class="admissionCase">
                    <wgt:name>Случай </wgt:name>
                    <wgt:model>query</wgt:model>
                    <wgt:query-id>resultAdmissionCase</wgt:query-id>
                    <fs:field-set>
                        <fs:row>
                        <!--поле необходимое для того чтобы выбирать значение по дефолту-->
                        <ctrl:classifier id="mcCaseHidden" label="Случай обслуживания" visible="false" readonly="true">
                            <ctrl:query query-id="patientClinicCase" label-field-id="name" value-field-id="id">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="patientId" ref="patient.id"/>
                                    <ctrl:pre-filter field-id="caseClosing" type="isNull"/>
                                    <ctrl:pre-filter field-id="org.id" value="#{org.id?}"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                            <ctrl:update-model query-id="patientClinicCase" master-field-id="mcCaseHidden.id"
                                               detail-field-id="id" target="field"/>
                        </ctrl:classifier>
                        <ctrl:classifier id="mcCase" label="Случай обращения" search-as-you-type="true" required="true" control-style="width:405px;" label-style="font-weight:bold; text-decoration: underline;" readonly="true">
                            <ctrl:query query-id="patientClinicCase" label-field-id="name" value-field-id="id">
                                <ctrl:pre-filters>
                                    <ctrl:pre-filter field-id="patientId" ref="patient.id"/>
                                    <ctrl:pre-filter field-id="caseClosing" type="isNull"/>
                                    <ctrl:pre-filter field-id="org.id" value="#{org.id?}"/>
                                </ctrl:pre-filters>
                            </ctrl:query>
                            <ctrl:dependencies>
                                <ctrl:enabling-condition>
                                    isCaseStateFin == false
                                </ctrl:enabling-condition>
                            </ctrl:dependencies>
                            <!--<ctrl:actions>
                                <ctrl:button label="Новый случай">
                                    <ctrl:set-value-expression>
                                        var o = new Object();
                                        o.id = 1;
                                        o.name = 'Новый случай';
                                        o.caseOpenDate = mcCaseDef.caseOpenDate;
                                        o.fundingSourceType = mcCaseDef.fundingSourceType;
                                        o.caseType = mcCaseDef.caseType;
                                        o.careRegimen = mcCaseDef.careRegimen;
                                        o.openMoreInfo = false;
                                        o.newCase = true;
                                        o;
                                    </ctrl:set-value-expression>
                                    <ctrl:dependencies>
                                        <ctrl:enabling-condition>
                                            mcCaseId == null
                                        </ctrl:enabling-condition>
                                    </ctrl:dependencies>
                                </ctrl:button>
                            </ctrl:actions>-->
                            <ctrl:set-value-expression>
                                <![CDATA[
                                if (mcCaseHidden.id == null && mcCase.id == null){
                                var o = new Object();
                                o.id = 1;
                                o.name = 'Новый случай';
                                o.caseOpenDate = mcCaseDef.caseOpenDate;
                                o.fundingSourceType = mcCaseDef.fundingSourceType;
                                o.caseType = mcCaseDef.caseType;
                                o.careRegimen = mcCaseDef.careRegimen;
                                o.openMoreInfo = false;
                                o.newCase = true;
                                o;
                                } else {
                                    if(mcCase.id == null && mcCaseHidden.name != null){
                                        mcCaseHidden;
                                    }else{
                                        mcCase;
                                    }
                                }

                                ]]>
                            </ctrl:set-value-expression>
                        </ctrl:classifier>
                            <ctrl:checkbox id="mcCase.openMoreInfo" label="Параметры случая" label-style="width:0px" control-style="margin-left:0px;" readonly="true">
                                <ctrl:set-value if="mcCaseId != null" then="false"/>
                            </ctrl:checkbox>
                        </fs:row>
                        <fs:row style="white-space:nowrap">
                            <ctrl:checkbox id="mcCase.isFinanceTypeControl" label="контроль источника финансирования"
                                           dependency-condition="mcCase.openMoreInfo == true" default-value="false"
                                           control-style="margin-left:0px; width:300px" label-style="width:100px"
                                           copied="false" readonly="true"/>
                        </fs:row>
                        <fs:row>
                            <ctrl:date-time id="mcCase.caseOpenDate" required="true" dependency-condition="mcCase.openMoreInfo == true" readonly="true"/>
                            <ctrl:classifier id="mcCase.fundingSourceType" label="Вид финансирования" readonly="true"
                                             search-are-you-type="true" required="true" dependency-condition="mcCase.openMoreInfo == true">
                                <ctrl:query query-id="clinicFundingSourceType" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:classifier id="mcCase.caseType" label="Вид случая" search-are-you-type="true" dependency-condition="mcCase.openMoreInfo == true" required="true" readonly="true">
                                <ctrl:query query-id="caseType" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="mcCase.careRegimen" label="Условия оказания" search-are-you-type="true" readonly="true"
                                             required="true" dependency-condition="mcCase.openMoreInfo == true">
                                <ctrl:query query-id="careRegimen" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:classifier id="mcCase.careProvidingForm" label="Форма оказания МП" readonly="true"
                                             search-are-you-type="true" dependency-condition="mcCase.openMoreInfo == true">
                                <ctrl:query query-id="careProvidingForm" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:classifier id="mcCase.caseInitGoal" label="Цель обращения" search-are-you-type="true" dependency-condition="mcCase.openMoreInfo == true" required="true" readonly="true">
                                <ctrl:query query-id="initGoal" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="mcCase.careLevel" label="Уровень мед. помощи" readonly="true"
                                             search-are-you-type="true" dependency-condition="mcCase.openMoreInfo == true">
                                <ctrl:query query-id="careLevel" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                        <ctrl:classifier id="mcCase.careProvisionCondition" label="Режим лечения" readonly="true"
                                         search-are-you-type="true" dependency-condition="mcCase.openMoreInfo == true">
                            <ctrl:query query-id="careProvisionCondition" label-field-id="name"
                                        value-field-id="id"/>
                        </ctrl:classifier>
                            <ctrl:classifier id="referral" label="Направление" search-as-you-type="true" dependency-condition="mcCase.openMoreInfo == true &amp;&amp; mcCaseId == null" readonly="true">
                                <ctrl:query query-id="doctorReferral" label-field-id="name" value-field-id="id">
                                    <ctrl:pre-filters>
                                        <ctrl:pre-filter field-id="patientId" ref="patient.id"/>
                                        <ctrl:pre-filter field-id="isImplemented" value="true"/>
                                    </ctrl:pre-filters>
                                </ctrl:query>
                            </ctrl:classifier>
                        </fs:row>
                    </fs:field-set>
                </wgt:edit-form>
            </container>
        </region>
        <region place="bottom-left" type="none">
            <container id="admissionVisit" place="right" depends-on="admissionCase" refresh-dependent-container="true">
                <wgt:table master-field-id="mcCaseId" detail-field-id="mcCaseId">
                    <wgt:name>Посещение</wgt:name>
                    <wgt:query-id>resultAdmissionVisit</wgt:query-id>
                    <wgt:size>5</wgt:size>
                    <!--<fs:field-set>
                        <ctrl:output-text id="mcCaseId" visible="false"/>
                    <ctrl:checkbox-grid id="visitGrid" label=" " label-style="width:0px" control-style="width:900px">
                        <ctrl:query query-id="resultAdmissionCase" label-field-id="visit.id" value-field-id="visit.id">
                            <ctrl:pre-filters>
                                <ctrl:pre-filter field-id="mcCaseId" ref="mcCaseId"/>
                            </ctrl:pre-filters>
                        </ctrl:query>-->
                    <wgt:columns>
                        <wgt:column column-field-id="dtStep" width="30%"/>
                   <!--     <wgt:column column-field-id="caseGoal"/>
                        <wgt:column column-field-id="visitPlace"/>-->
                        <wgt:column column-field-id="resGroup.name"/>
                    </wgt:columns>
                    <!--</ctrl:checkbox-grid>
                    </fs:field-set>-->
                    <wgt:sortings>
                        <wgt:sorting sorting-field-id="dtStep" direction="DESC"/>
                    </wgt:sortings>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="initialFundingSourceType" ref="initialFundingSourceType"/>
                    <pre-filter field-id="initialIsFinanceTypeControl" ref="initialIsFinanceTypeControl"/>
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-TAP" type="none">
            <container id="ticketOutpatientCase" depends-on="admissionVisit" refresh-dependent-container="true">
                <wgt:edit-form master-field-id="visit.id" detail-field-id="id" css-class="tap" style="height: 400px;">
                    <wgt:name>ТАП</wgt:name>
                    <wgt:query-id>ticketOutpatientCase</wgt:query-id>
                   <wgt:model>query</wgt:model>
                    <fs:field-set>
                        <fs:row style="padding-top: 10px;">
                            <ctrl:classifier id="mcCase.diagnosis" label="Диагноз:" search-are-you-type="true" control-style="width: 200px;" required="true" readonly="true">
                                <ctrl:query query-id="clinicMdDiagnosis" label-field-id="name" value-field-id="id">
                                    <ctrl:pre-filters>
                                        <ctrl:pre-filter field-id="patientId" ref="patientId"/>
                                    </ctrl:pre-filters>
                                </ctrl:query>
                            </ctrl:classifier>
                            <ctrl:classifier id="mcCase.diseaseType" label="Характер заболевания:" search-are-you-type="true" readonly="true"
                                             control-style="width: 200px;" required="true">
                                <ctrl:query query-id="diseaseType" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="mcCase.service" label="Услуга" search-are-you-type="true" control-style="width:200px;" required="true" readonly="true">
                                <ctrl:query query-id="srService" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:classifier id="mcCase.visitPlace" label="Место обслуживания" search-are-you-type="true" control-style="width:200px" required="true" readonly="true">
                                <ctrl:query query-id="visitPlace" label-field-id="name" value-field-id="id"/>
                            </ctrl:classifier>
                            <ctrl:checkbox id="initiatior" label="Актив" label-style="display:none;" control-style="width:50px; position:" readonly="true"/>
                        </fs:row>
                    </fs:field-set>
                    <fs:field-set header="line">
                        <fs:row>
                        <ctrl:checkbox id="isCaseState" label="23.Законченный случай" readonly="true">
                            <ctrl:dependencies>
                                <ctrl:enabling-condition>
                                    isLastStep == true
                                </ctrl:enabling-condition>
                            </ctrl:dependencies>
                        </ctrl:checkbox>
                            <ctrl:classifier id="repeatCount" label="24. Обращение" search-are-you-type="true" readonly="true"
                                             dependency-condition="isCaseState == true" control-style="width:200px" label-style="width:140px;">
                                <ctrl:query query-id="clinicCaseRepeatCount" label-field-id="name" value-field-id="id"/>
                               <ctrl:set-value-expression on="mcCase.diagnosis.repeatCount,isCaseState" on-load="false">mcCase.diagnosis.repeatCount</ctrl:set-value-expression>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="paymentMethod" label="Способ оплаты" search-are-you-type="true" readonly="true"
                                             dependency-condition="isCaseState == true" control-style="width:200px">
                                <ctrl:query query-id="paymentMethod" label-field-id="name" value-field-id="id">
                                    <ctrl:pre-filters>
                                        <ctrl:pre-filter field-id="careRegimenId" ref="mcCase.careRegimen.id"/>
                                    </ctrl:pre-filters>
                                </ctrl:query>
                            </ctrl:classifier>
                            <ctrl:output-text id="mainDiagnosis" depends-on="mcCase.diagnosis" dependency-condition="(isCaseState == true)&amp;&amp;(mcCase.diagnosis.id == null)||(mcCase.diagnosis.id == 'undefined')" label="Диагноз закл."/>
                            <ctrl:output-text id="mcCase.diagnosis.name" depends-on="mcCase.diagnosis" dependency-condition="(isCaseState == true)&amp;&amp;(mcCase.diagnosis.id != null)" label="Диагноз закл."/>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="stepResult" label="25.Результат обращения" search-are-you-type="true" readonly="true"
                                             required="true" dependency-condition="isCaseState == true" control-style="width:200px">
                                <ctrl:query query-id="stepResultClinic" label-field-id="name" value-field-id="id">
                                    <ctrl:pre-filters>
                                        <ctrl:pre-filter field-id="regimenId" ref="mcCase.careRegimen.id"/>
                                    </ctrl:pre-filters>
                                </ctrl:query>
                            </ctrl:classifier>
                            <ctrl:classifier id="outcome" label="Исход заболевания" search-are-you-type="true" readonly="true"
                                             required="true"
                                             dependency-condition="isCaseState == true" depends-on="stepResult" control-style="width:200px">
                                <ctrl:query query-id="stepCareResult" label-field-id="name" value-field-id="id"
                                            detail-field-id="stepResult.id" master-field-id="id"/>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:classifier id="rankin" label="Степень тяжести при выбытии (по шкале Рэнкин)" readonly="true"
                                             dependency-condition="isCaseState == true" control-style="width:200px">
                                <ctrl:query query-id="clinic_mc_rankin_scale"/>
                            </ctrl:classifier>
                        </fs:row>
                        <fs:row>
                            <ctrl:date-time id="outcomeDate" label="50.Дата закрытия талона" format="DD.MM.YYYY" readonly="true"
                                            default-value="today()"
                                            dependency-condition="isCaseState == true" required="true" control-style="width:200px">
                                <ctrl:validations>
                                    <ctrl:validation ref-id="closeDateCheck" side="client"/>
                                </ctrl:validations>
                            </ctrl:date-time>
                            <ctrl:output-text id="resGroup.name" control-style="width:400px" dependency-condition="isCaseState == true"/>
                        </fs:row>
                    </fs:field-set>


                    <!--<fs:field-set header="line" label="Стоматология">
                        <fs:row>
                            <ctrl:checkbox id="isViewed" label="Осмотрено"
                                           dependency-condition="isIndependent == true"/>
                            <ctrl:checkbox id="isNeeded" label="Нуждалось"
                                           dependency-condition="isIndependent == true"/>
                            <ctrl:output-text id="4" label=" "/>
                        </fs:row>
                        <ctrl:checkbox id="isSanitized" label="Санировано"
                                       dependency-condition="isIndependent == true"/>
                    </fs:field-set>-->
                </wgt:edit-form>
                <pre-filters>
                    <pre-filter field-id="isAppointment" value="true"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
            </region>
        <region place="bottom-right-tab-services" type="none">
            <container id="servicesAndProtocols" depends-on="admissionVisit" refresh-dependent-container="true">
                <wgt:table master-field-id="visit.id" detail-field-id="visit.id" css-class="tap">
                    <wgt:name>Услуги/Протоколы</wgt:name>
                    <wgt:query-id>serviceAndProtocol</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="serviceName"/>
                        <wgt:column column-field-id="quantity"/>
                        <wgt:column column-field-id="diagnosis.name"/>
                        <wgt:column column-field-id="totalCost"/>
                        <wgt:column column-field-id="fundingType.name"/>
                        <wgt:column column-field-id="bdate"/>
                        <wgt:column column-field-id="resGroup.name"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="isRendered" value="true"/>
                    <pre-filter field-id="initialFundingSourceType" ref="initialFundingSourceType"/>
                    <pre-filter field-id="initialIsFinanceTypeControl" ref="initialIsFinanceTypeControl"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
            </region>
        <region place="bottom-right-tab-diagnosis" type="none">
            <container id="diagnosis" depends-on="admissionVisit" refresh-dependent-container="true">
                <wgt:table master-field-id="visit.id" detail-field-id="visit.id" css-class="tap">
                    <wgt:name>Диагноз</wgt:name>
                    <wgt:query-id>clinicDiagnosis</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="diagnosis.name">
                            <wgt:color color-field-id="isMainDiagnosColor"/>
                        </wgt:column>
                        <wgt:column column-field-id="diagnosisTypeName">
                            <wgt:color color-field-id="badge"/>
                        </wgt:column>
                        <wgt:column column-field-id="stage.name">
                            <wgt:color color-field-id="isMainDiagnosColor"/>
                        </wgt:column>
                        <wgt:column column-field-id="diagnosis.isDAccounting">
                            <wgt:checkbox/>
                        </wgt:column>
                        <wgt:column column-field-id="doctor.name">
                            <wgt:color color-field-id="isMainDiagnosColor"/>
                        </wgt:column>
                        <wgt:column column-field-id="injuryType.name">
                            <wgt:color color-field-id="isMainDiagnosColor"/>
                        </wgt:column>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="id" type="isNotNull"/>
                    <pre-filter field-id="isCaseState" ref="visit.isCaseState"/>
                    <pre-filter field-id="mcCase" ref="visit.mcCaseId"/>
                    <pre-filter field-id="patient.id" ref="visit.patientId"/>
                    <pre-filter field-id="resGroup.name" ref="visit.resGroupName"/>
                    <pre-filter field-id="resGroup.id" ref="visit.doctorId"/>
                    <pre-filter field-id="mainDiagnosis.id" ref="visit.caseMainDiagnosisId"/>
                    <!--<pre-filter field-id="stage.id" ref="visit.DiagnosisStageId"/>-->
                    <pre-filter field-id="org.id" ref="visit.orgId"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
            </region>
        <region place="bottom-right-tab-referral" type="list">
            <container id="referral" depends-on="admissionVisit" opened="true">
                <wgt:table master-field-id="visit.patientId" detail-field-id="patientId" css-class="tap">
                    <wgt:name>Направления</wgt:name>
                    <wgt:size>5</wgt:size>
                    <wgt:query-id>clinicReferral</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="name" name="Номер направления"/>
                        <wgt:column column-field-id="referralTypeName" name="Вид направления"/>
                        <wgt:column column-field-id="date" name="Дата направления"/>
                        <wgt:column column-field-id="status" name="Исполнено">
                            <wgt:checkbox/>
                        </wgt:column>
                        <wgt:column column-field-id="recvOrg.name" name="В МО"/>
                        <wgt:column column-field-id="recvDepartment.name" name="В отделение"/>
                        <wgt:column column-field-id="recvDoctor.name" name="К врачу"/>
                        <wgt:column column-field-id="diagnosis.name" name="Диагноз"/>
                        <wgt:column column-field-id="isUrgent" name="Срочно">
                            <wgt:checkbox/>
                        </wgt:column>
                        <wgt:column column-field-id="service" name="Услуга"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="caseId" ref="visit.mcCaseId"/>
                    <pre-filter field-id="referralDiagnosis.id" ref="visit.mdMainDiagnosisId"/>
                    <pre-filter field-id="stepId" ref="visit.id"/>
                    <pre-filter field-id="initialFundingSourceType" ref="initialFundingSourceType"/>
                    <pre-filter field-id="initialIsFinanceTypeControl" ref="initialIsFinanceTypeControl"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
            <container id="pre-entry" depends-on="referral" opened="true">
                <wgt:table master-field-id="patientId" detail-field-id="patientId" css-class="tap">
                    <wgt:name>Предварительная запись</wgt:name>
                    <wgt:size>5</wgt:size>
                    <wgt:query-id>clinicPreEntry</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="ticketNumber" name="Номер талона" width="10%"/>
                        <wgt:column column-field-id="bDate" name="Дата" width="10%"/>
                        <wgt:column column-field-id="bTime" name="Время" width="10%"/>
                        <wgt:column column-field-id="service" name="Услуга"/>
                        <wgt:column column-field-id="executor" name="Специалист"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="status" value="true"/>
                    <pre-filter field-id="orgId" value="#{org.id?}"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                    <!-- RMISDEV-399
                    <pre-filter field-id="resourceGroupId" ref="resourceGroupId"/>
                    <pre-filter field-id="serviceId" ref="serviceId"/>-->
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-prescription" type="none">
            <container id="prescription" depends-on="admissionVisit">
                <wgt:table master-field-id="visit.id" detail-field-id="stepId" css-class="tap">
                    <wgt:name>Назначения</wgt:name>
                    <wgt:query-id>clinicPrescriptionList</wgt:query-id>
                    <wgt:size>5</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="service.prescriptionName" name="Назначение"/>
                        <wgt:column column-field-id="periodInterval" name="Период (дни)" width="25%"/>
                        <wgt:column column-field-id="prescriptionCount" name="Количество"/>
                        <wgt:column column-field-id="periodicity.name" name="Периодичность"/>
                        <wgt:column column-field-id="visitTerm.name" name="Условия"/>
                        <wgt:column column-field-id="status" name="Статус"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="caseId" ref="visit.mcCaseId"/>
                    <pre-filter field-id="patientId" ref="visit.patientId"/>
                    <pre-filter field-id="resourceGroup.id" ref="resourceGroup.id"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-receipt" type="none">
            <container id="receiptList" depends-on="admissionVisit">
                <wgt:table master-field-id="visit.id" detail-field-id="step.id" css-class="tap">
                    <wgt:name>Рецепты</wgt:name>
                    <wgt:query-id>receiptJournal</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="issue_dt"/>
                        <wgt:column column-field-id="type.name"/>
                        <wgt:column column-field-id="inv_inn.name"/>
                        <wgt:column column-field-id="form_type.name"/>
                        <wgt:column column-field-id="dosage"/>
                        <wgt:column column-field-id="use_method"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="patient.id" ref="visit.patientId"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                    <pre-filter field-id="privilegedReceiptForNonRegisterPatients" ref="privilegedReceiptForNonRegisterPatients"/>
                    <pre-filter field-id="caseId" ref="mcCaseId"/>
                    <pre-filter field-id="stepId" ref="visit.id"/>
                    <pre-filter field-id="checkPatientAge" ref="checkPatientAge"/>
                    <pre-filter field-id="checkNotModuleReceipt" value="true"/>
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-sickList" type="none">
            <container id="sickList" depends-on="admissionVisit">
                <wgt:table master-field-id="visit.mcCaseId" detail-field-id="caseId" css-class="tap">
                    <wgt:name>Листы нетрудоспособности</wgt:name>
                    <wgt:size>5</wgt:size>
                    <wgt:query-id>clinicSickList</wgt:query-id>
                    <wgt:columns>
                        <wgt:column column-field-id="code" name="Номер ЛН"/>
                        <wgt:column column-field-id="issueDt" name="Дата выдачи"/>
                        <wgt:column column-field-id="type.name" name="Тип ЛН"/>
                        <wgt:column column-field-id="state.name" name="Статус"/>
                        <wgt:column column-field-id="periodDt" name="Дата закрытия"/>
                        <wgt:column column-field-id="disabilityReason.name" name="Причина"/>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="patientId" ref="visit.patientId"/>
                    <pre-filter field-id="patientName" ref="visit.patientName"/>
                    <pre-filter field-id="mdMainDiagnosisId" ref="visit.mdMainDiagnosisId"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-vaccinations" type="none">
            <container id="vaccinations" depends-on="personalDataOfThePatient">
                <wgt:table master-field-id="patient.id" detail-field-id="individual.id">
                    <wgt:query-id>map_vaccination</wgt:query-id>
                    <wgt:name>Журнал прививок</wgt:name>
                    <wgt:size>20</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="data" width="50px"/>
                        <wgt:column column-field-id="age" width="75px"/>
                        <wgt:column column-field-id="disease.label" width="100px"/>
                        <wgt:column column-field-id="number.label" name="Этап" width="50px"/>
                        <wgt:column column-field-id="vaccine.label" width="100px"/>
                        <wgt:column column-field-id="status.label" width="75px"/>
                        <wgt:column column-field-id="dose.label" width="50px"/>
                        <wgt:column column-field-id="inp_type.label" width="100px"/>
                        <wgt:column column-field-id="series.label" width="50px"/>
                        <wgt:column column-field-id="result" name="Результат" width="50px"/>
                    </wgt:columns>
                    <wgt:rows>
                        <wgt:color>
                            <wgt:switch value-field-id="color">
                                <wgt:case value="overdue">error</wgt:case>
                                <wgt:case value="execute">text-info</wgt:case>
                                <wgt:case value="deny">warning</wgt:case>
                            </wgt:switch>
                        </wgt:color>
                    </wgt:rows>
                    <wgt:sortings>
                        <wgt:sorting sorting-field-id="date" direction="ASC"/>
                        <wgt:sorting sorting-field-id="individual.FIO" direction="ASC"/>
                    </wgt:sortings>
                    <wgt:filters>
                        <ctrl:classifier id="status" search-as-you-type="true" label="Статус" readonly="true">
                            <ctrl:query query-id="status_control" label-field-id="label" value-field-id="id"/>
                        </ctrl:classifier>
                    </wgt:filters>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
        </region>
        <region place="bottom-right-tab-cert" type="none">
            <container id="cert" depends-on="admissionVisit">
                <wgt:table master-field-id="visit.mcCaseId" detail-field-id="mcase.id" css-class="tap">
                    <wgt:query-id>clinicCertList</wgt:query-id>
                    <wgt:size>20</wgt:size>
                    <wgt:columns>
                        <wgt:column column-field-id="number" width="10%"/>
                        <wgt:column column-field-id="creationDate" width="10%" format="date DD.MM.YYYY"/>
                        <wgt:column column-field-id="employeeIssued.name"/>
                        <wgt:column column-field-id="receiver.name"/>
                        <wgt:column column-field-id="refused" width="10%" tooltip-field-id="refusedIconName">
                            <wgt:icon icon-field-id="refusedIcon"/>
                        </wgt:column>
                        <wgt:column column-field-id="annuled" width="10%">
                            <wgt:icon icon-field-id="annuledIcon"/>
                        </wgt:column>
                    </wgt:columns>
                </wgt:table>
                <pre-filters>
                    <pre-filter field-id="mcaseIsNotNull" type="isNotNull"/>
                    <pre-filter field-id="patientId" ref="visit.patientId"/>
                    <pre-filter field-id="isStomatologyVisit" ref="isStomatologyVisit"/>
                </pre-filters>
            </container>
        </region>
    </regions>
</page>
